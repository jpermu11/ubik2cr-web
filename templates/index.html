<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubik2CR - Tu cantÃ³n en tu mano</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <style>
        body { background-color: #f5f7fa; }

        .hero {
            background: linear-gradient(135deg, #0b4fa3, #38b24d);
            color: white;
            padding: 90px 0 80px;
            text-align: center;
        }
        .hero img { max-width: 160px; margin-bottom: 20px; }
        .hero h1 { font-weight: 800; font-size: 3rem; }
        .hero p { font-size: 1.3rem; }

        .card-negocio {
            border: none;
            border-radius: 14px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: 0.2s;
            overflow: hidden;
        }
        .card-negocio:hover { transform: translateY(-4px); }
    </style>
</head>

<body>

<!-- HEADER -->
<nav class="navbar navbar-expand-lg" style="background:linear-gradient(90deg,#0b4fa3,#38b24d);">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="/">
            <img src="{{ url_for('static', filename='uploads/logo.png') }}" height="55" alt="Ubik2CR">
            <strong class="text-white fs-4">Ubik2CR</strong>
        </a>

        <div class="ms-auto d-flex gap-2 flex-wrap">

            <!-- âœ… SIEMPRE VISIBLE -->
            <a href="/cuenta" class="btn btn-outline-light fw-bold">
                ğŸ‘¤ Cuenta
            </a>
            {% if session.get('user_id') %}
            <a href="/favoritos" class="btn btn-outline-light fw-bold"> â¤ï¸ Favoritos </a>
            {% endif %}
            {% if session.get('admin_logged_in') %}
                <a href="/admin" class="btn btn-light fw-bold">Panel Admin</a>
                <a href="/logout" class="btn btn-outline-light">Salir</a>
            {% else %}
                <a href="/login" class="btn btn-light fw-bold">AdministraciÃ³n</a>
            {% endif %}
        </div>
    </div>
</nav>

<!-- HERO -->
<section class="hero">
    <div class="container">
        <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR">
        <h1>Tu cantÃ³n en tu mano</h1>
        <p>Negocios, servicios y lugares de tu comunidad</p>

        <!-- âœ… BOTÃ“N MAPA -->
        <div class="mt-4">
            <a href="/mapa" class="btn btn-light fw-bold px-4 py-2 rounded-pill">
                ğŸ“ Ver en mapa
            </a>
        </div>
    </div>
</section>

<!-- CARRUSEL DE OFERTAS -->
{% if ofertas_activas and ofertas_activas|length > 0 %}
<div class="container my-4">
    <div id="ofertasCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
        <div class="carousel-inner rounded" style="border-radius: 15px !important; overflow: hidden;">
            {% for oferta in ofertas_activas %}
            <div class="carousel-item {% if loop.first %}active{% endif %}" style="cursor: pointer;" onclick="window.location.href='/negocio/{{ oferta.negocio_id }}'">
                <div class="position-relative">
                    <img src="{{ get_safe_image_url(oferta.imagen_url) }}" class="d-block w-100" alt="{{ oferta.titulo }}" style="height: 300px; object-fit: cover;">
                    <!-- Overlay con informaciÃ³n (visible en todos los tamaÃ±os) -->
                    <div class="position-absolute bottom-0 start-0 end-0" style="background: linear-gradient(to top, rgba(0,0,0,0.85), rgba(0,0,0,0.5), transparent); padding: 15px 20px;">
                        <h5 class="fw-bold text-white mb-1">{{ oferta.titulo }}</h5>
                        {% if oferta.descripcion %}
                        <p class="text-white mb-1" style="font-size: 0.9rem; line-height: 1.3;">{{ oferta.descripcion[:80] }}{% if oferta.descripcion|length > 80 %}...{% endif %}</p>
                        {% endif %}
                        <small class="text-white-50">VÃ¡lido hasta: {{ oferta.fecha_caducidad.strftime('%d/%m/%Y') }}</small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% if ofertas_activas|length > 1 %}
        <button class="carousel-control-prev" type="button" data-bs-target="#ofertasCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#ofertasCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Siguiente</span>
        </button>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- BUSCADOR -->
<div class="container mt-5">
    <form method="get" class="row g-3">
        <div class="col-md-5">
            <input type="text" name="q" class="form-control" placeholder="Â¿QuÃ© estÃ¡s buscando?"
                   value="{{ request.args.get('q','') }}">
        </div>

        <div class="col-md-4">
            <select name="cat" class="form-select">
                <option value="Todas" {% if categoria_actual == 'Todas' %}selected{% endif %}>Todas las categorÃ­as</option>
                
                <optgroup label="ğŸ½ï¸ Comida y Bebidas">
                    <option value="Sodas y Rest." {% if categoria_actual == 'Sodas y Rest.' %}selected{% endif %}>ğŸ´ Sodas y Rest.</option>
                    <option value="Comida RÃ¡pida" {% if categoria_actual == 'Comida RÃ¡pida' %}selected{% endif %}>ğŸ• Comida RÃ¡pida</option>
                    <option value="CafeterÃ­as" {% if categoria_actual == 'CafeterÃ­as' %}selected{% endif %}>â˜• CafeterÃ­as</option>
                    <option value="Bares y Licores" {% if categoria_actual == 'Bares y Licores' %}selected{% endif %}>ğŸº Bares y Licores</option>
                    <option value="HeladerÃ­as" {% if categoria_actual == 'HeladerÃ­as' %}selected{% endif %}>ğŸ¦ HeladerÃ­as</option>
                    <option value="Restaurante" {% if categoria_actual == 'Restaurante' %}selected{% endif %}>ğŸ” Restaurantes</option>
                </optgroup>
                
                <optgroup label="ğŸ›’ Alimentos">
                    <option value="VerdurerÃ­as" {% if categoria_actual == 'VerdurerÃ­as' %}selected{% endif %}>ğŸ¥¬ VerdurerÃ­as</option>
                    <option value="CarnicerÃ­as" {% if categoria_actual == 'CarnicerÃ­as' %}selected{% endif %}>ğŸ¥© CarnicerÃ­as</option>
                    <option value="PanaderÃ­as" {% if categoria_actual == 'PanaderÃ­as' %}selected{% endif %}>ğŸ¥ PanaderÃ­as</option>
                    <option value="Super y Pulpes" {% if categoria_actual == 'Super y Pulpes' %}selected{% endif %}>ğŸ›’ Super y Pulpes</option>
                </optgroup>
                
                <optgroup label="ğŸ¥ Salud">
                    <option value="Farmacias" {% if categoria_actual == 'Farmacias' %}selected{% endif %}>ğŸ’Š Farmacias</option>
                    <option value="ClÃ­nicas y Dr." {% if categoria_actual == 'ClÃ­nicas y Dr.' %}selected{% endif %}>ğŸ©º ClÃ­nicas y Dr.</option>
                    <option value="Dentistas" {% if categoria_actual == 'Dentistas' %}selected{% endif %}>ğŸ¦· Dentistas</option>
                    <option value="Laboratorios" {% if categoria_actual == 'Laboratorios' %}selected{% endif %}>ğŸ§ª Laboratorios</option>
                    <option value="Veterinarias" {% if categoria_actual == 'Veterinarias' %}selected{% endif %}>ğŸ¾ Veterinarias</option>
                    <option value="Ã“pticas" {% if categoria_actual == 'Ã“pticas' %}selected{% endif %}>ğŸ‘“ Ã“pticas</option>
                    <option value="CCSS" {% if categoria_actual == 'CCSS' %}selected{% endif %}>ğŸ¥ CCSS / ClÃ­nica / EbÃ¡is</option>
                </optgroup>
                
                <optgroup label="ğŸ’… Belleza y Fitness">
                    <option value="Gimnasios" {% if categoria_actual == 'Gimnasios' %}selected{% endif %}>ğŸ’ª Gimnasios</option>
                    <option value="Spas y Masajes" {% if categoria_actual == 'Spas y Masajes' %}selected{% endif %}>ğŸ§˜ Spas y Masajes</option>
                    <option value="Belleza y BarberÃ­a" {% if categoria_actual == 'Belleza y BarberÃ­a' %}selected{% endif %}>âœ‚ï¸ Belleza y BarberÃ­a</option>
                </optgroup>
                
                <optgroup label="ğŸ‘• Ropa y TecnologÃ­a">
                    <option value="Ropa y Calzado" {% if categoria_actual == 'Ropa y Calzado' %}selected{% endif %}>ğŸ‘— Ropa y Calzado</option>
                    <option value="TecnologÃ­a y Cel." {% if categoria_actual == 'TecnologÃ­a y Cel.' %}selected{% endif %}>ğŸ“± TecnologÃ­a y Cel.</option>
                    <option value="Reparaciones Tech" {% if categoria_actual == 'Reparaciones Tech' %}selected{% endif %}>ğŸ’» Reparaciones Tech</option>
                </optgroup>
                
                <optgroup label="ğŸ”§ ConstrucciÃ³n y Automotriz">
                    <option value="FerreterÃ­as" {% if categoria_actual == 'FerreterÃ­as' %}selected{% endif %}>ğŸ”¨ FerreterÃ­as</option>
                    <option value="Materiales ConstrucciÃ³n" {% if categoria_actual == 'Materiales ConstrucciÃ³n' %}selected{% endif %}>ğŸ§± Materiales ConstrucciÃ³n</option>
                    <option value="MecÃ¡nica y Llantas" {% if categoria_actual == 'MecÃ¡nica y Llantas' %}selected{% endif %}>ğŸ”§ MecÃ¡nica y Llantas</option>
                    <option value="Transporte" {% if categoria_actual == 'Transporte' %}selected{% endif %}>ğŸš• Transporte</option>
                    <option value="Gasolineras" {% if categoria_actual == 'Gasolineras' %}selected{% endif %}>â›½ Gasolineras</option>
                    <option value="Automotriz" {% if categoria_actual == 'Automotriz' %}selected{% endif %}>ğŸš— Automotriz</option>
                </optgroup>
                
                <optgroup label="ğŸ“š EducaciÃ³n y Cultura">
                    <option value="LibrerÃ­as y Bazar" {% if categoria_actual == 'LibrerÃ­as y Bazar' %}selected{% endif %}>ğŸ“– LibrerÃ­as y Bazar</option>
                    <option value="Escuelas" {% if categoria_actual == 'Escuelas' %}selected{% endif %}>ğŸ« Escuelas</option>
                    <option value="Bibliotecas" {% if categoria_actual == 'Bibliotecas' %}selected{% endif %}>ğŸ“š Bibliotecas</option>
                    <option value="Academias" {% if categoria_actual == 'Academias' %}selected{% endif %}>ğŸ“ Academias</option>
                    <option value="Educacion" {% if categoria_actual == 'Educacion' %}selected{% endif %}>ğŸ“ EducaciÃ³n</option>
                </optgroup>
                
                <optgroup label="ğŸ¨ Turismo y Entretenimiento">
                    <option value="Hoteles y Hospedaje" {% if categoria_actual == 'Hoteles y Hospedaje' %}selected{% endif %}>ğŸ¨ Hoteles y Hospedaje</option>
                    <option value="Parques" {% if categoria_actual == 'Parques' %}selected{% endif %}>ğŸŒ³ Parques</option>
                    <option value="Plazas" {% if categoria_actual == 'Plazas' %}selected{% endif %}>ğŸï¸ Plazas</option>
                    <option value="Polideportivo" {% if categoria_actual == 'Polideportivo' %}selected{% endif %}>ğŸŸï¸ Polideportivos</option>
                    <option value="Cines y Entretenimiento" {% if categoria_actual == 'Cines y Entretenimiento' %}selected{% endif %}>ğŸ¬ Cines y Entretenimiento</option>
                    <option value="Turismo" {% if categoria_actual == 'Turismo' %}selected{% endif %}>ğŸ—ºï¸ Turismo</option>
                </optgroup>
                
                <optgroup label="ğŸ’° Finanzas">
                    <option value="Bancos" {% if categoria_actual == 'Bancos' %}selected{% endif %}>ğŸ¦ Bancos</option>
                    <option value="Cooperativas" {% if categoria_actual == 'Cooperativas' %}selected{% endif %}>ğŸ’µ Cooperativas</option>
                </optgroup>
                
                <optgroup label="ğŸ›ï¸ Servicios PÃºblicos">
                    <option value="Cruz Roja" {% if categoria_actual == 'Cruz Roja' %}selected{% endif %}>ğŸš‘ Cruz Roja</option>
                    <option value="Bomberos" {% if categoria_actual == 'Bomberos' %}selected{% endif %}>ğŸš’ Bomberos</option>
                    <option value="PolicÃ­a" {% if categoria_actual == 'PolicÃ­a' %}selected{% endif %}>ğŸš“ PolicÃ­a</option>
                    <option value="Municipalidad" {% if categoria_actual == 'Municipalidad' %}selected{% endif %}>ğŸ›ï¸ Municipalidad</option>
                    <option value="Iglesia" {% if categoria_actual == 'Iglesia' %}selected{% endif %}>â›ª Iglesias</option>
                    <option value="Instituciones PÃºblicas" {% if categoria_actual == 'Instituciones PÃºblicas' %}selected{% endif %}>ğŸ¢ Instituciones PÃºblicas</option>
                    <option value="Edificio Gubernamental" {% if categoria_actual == 'Edificio Gubernamental' %}selected{% endif %}>ğŸ¢ Edificio Gubernamental</option>
                </optgroup>
                
                <optgroup label="ğŸ’¼ Servicios Profesionales">
                    <option value="Servicios Pro" {% if categoria_actual == 'Servicios Pro' %}selected{% endif %}>ğŸ’¼ Servicios Pro</option>
                    <option value="ConsultorÃ­a" {% if categoria_actual == 'ConsultorÃ­a' %}selected{% endif %}>ğŸ“Š ConsultorÃ­a</option>
                    <option value="Abogados" {% if categoria_actual == 'Abogados' %}selected{% endif %}>âš–ï¸ Abogados</option>
                    <option value="Contables" {% if categoria_actual == 'Contables' %}selected{% endif %}>ğŸ“‹ Contables</option>
                    <option value="Salones de Eventos" {% if categoria_actual == 'Salones de Eventos' %}selected{% endif %}>ğŸ‰ Salones de Eventos</option>
                    <option value="Mudanzas y Transporte" {% if categoria_actual == 'Mudanzas y Transporte' %}selected{% endif %}>ğŸšš Mudanzas y Transporte</option>
                    <option value="PlomerÃ­a y Electricidad" {% if categoria_actual == 'PlomerÃ­a y Electricidad' %}selected{% endif %}>âš¡ PlomerÃ­a y Electricidad</option>
                    <option value="JardinerÃ­a" {% if categoria_actual == 'JardinerÃ­a' %}selected{% endif %}>ğŸŒ± JardinerÃ­a</option>
                    <option value="Mascotas y Suministros" {% if categoria_actual == 'Mascotas y Suministros' %}selected{% endif %}>ğŸ• Mascotas y Suministros</option>
                    <option value="Servicios" {% if categoria_actual == 'Servicios' %}selected{% endif %}>ğŸ§° Servicios</option>
                </optgroup>
                
                <optgroup label="ğŸª Otros">
                    <option value="Comercio" {% if categoria_actual == 'Comercio' %}selected{% endif %}>ğŸª Comercios</option>
                    <option value="Otros" {% if categoria_actual == 'Otros' %}selected{% endif %}>âœ¨ Otros</option>
                </optgroup>
            </select>
        </div>

        <div class="col-md-3">
            <button class="btn btn-success w-100 fw-bold">Buscar</button>
        </div>
    </form>
</div>

<!-- RESULTADOS -->
<div class="container my-5">
    <div class="row g-4">
        {% for n in negocios %}
        <div class="col-md-4">
            <div class="card card-negocio h-100">
                <img src="{{ get_safe_image_url(n.imagen_url) if get_safe_image_url else (n.imagen_url if n.imagen_url else 'https://via.placeholder.com/600x400?text=Ubik2CR') }}"
                     class="card-img-top"
                     style="height:200px; object-fit:cover; background-color:#f0f0f0;"
                     alt="{{ n.nombre }}"
                     onerror="if(this.src.indexOf('placeholder') === -1) { this.src='https://via.placeholder.com/600x400?text=Ubik2CR'; this.onerror=null; }"
                     loading="lazy">
                <div class="card-body">
                    <span class="badge bg-primary">{{ n.categoria }}</span>
                    {% if n.es_vip %}
                    <span class="badge bg-warning text-dark">â­ VIP</span>
                    {% endif %}
                    <h5 class="mt-2 fw-bold">{{ n.nombre }}</h5>
                    <p class="text-muted small mb-2">{{ n.ubicacion }}</p>
                    {% if n.calificacion and n.calificacion > 0 %}
                    <div class="mb-2">
                        {% for i in range(5) %}
                            {% if i < n.calificacion|int %}
                                <i class="fas fa-star text-warning" style="font-size: 0.9rem;"></i>
                            {% elif i < n.calificacion|round %}
                                <i class="fas fa-star-half-alt text-warning" style="font-size: 0.9rem;"></i>
                            {% else %}
                                <i class="far fa-star text-warning" style="font-size: 0.9rem;"></i>
                            {% endif %}
                        {% endfor %}
                        <span class="text-muted small ms-1">{{ n.calificacion }} ({{ n.total_votos }})</span>
                    </div>
                    {% endif %}
                    <a href="/negocio/{{ n.id }}" class="btn btn-outline-primary w-100">Ver detalles</a>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12">
            <div class="alert alert-light border text-center py-5">
                <h5 class="mb-2">AÃºn no hay resultados</h5>
                <div class="text-muted">ProbÃ¡ con otra bÃºsqueda o seleccionÃ¡ "Todas las categorÃ­as".</div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

    <footer class="text-center py-4 bg-dark text-white mt-5">
        Â© 2025 Ubik2CR â€” Todos los derechos reservados
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

