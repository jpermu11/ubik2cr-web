<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubik2CR - Tu cantÃ³n en tu mano</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>

<!-- HEADER PREMIUM -->
<nav class="navbar-premium navbar-expand-lg">
    <div class="container-modern">
        <div class="d-flex align-items-center justify-content-between w-100">
            <a class="navbar-brand-premium" href="/">
                <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR">
                <span>Ubik2CR</span>
            </a>

            <div class="d-flex align-items-center gap-3 flex-wrap">
                <a href="/noticias" class="nav-link-premium">
                    <i class="fas fa-newspaper me-1"></i>Noticias
                </a>
                <a href="/cuenta" class="nav-link-premium">
                    <i class="fas fa-user me-1"></i>Cuenta
                </a>
                {% if session.get('user_id') %}
                <a href="/favoritos" class="nav-link-premium">
                    <i class="fas fa-heart me-1"></i>Favoritos
                </a>
                {% endif %}
                {% if session.get('admin_logged_in') %}
                    <a href="/admin" class="btn-modern btn-modern-primary">Panel Admin</a>
                    <a href="/logout" class="btn-modern btn-modern-ghost">Salir</a>
                {% else %}
                    <a href="/login" class="btn-modern btn-modern-primary">AdministraciÃ³n</a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

<!-- HERO PREMIUM -->
<section class="hero-premium">
    <div class="container-modern text-center">
        <div class="animate-fade-in-up">
            <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR" style="max-width: 180px; margin-bottom: 24px; filter: brightness(0) invert(1);">
            <h1>Tu cantÃ³n en tu mano</h1>
            <p>DescubrÃ­ los mejores negocios, servicios y lugares de tu comunidad</p>

            <div class="d-flex gap-3 justify-content-center flex-wrap mt-4">
                <a href="/mapa" class="btn-modern btn-modern-secondary" style="background: rgba(255,255,255,0.15); color: white; border-color: rgba(255,255,255,0.3);">
                    <i class="fas fa-map-marker-alt"></i> Ver en mapa
                </a>
                <a href="/noticias" class="btn-modern btn-modern-outline" style="background: rgba(255,255,255,0.1); color: white; border-color: rgba(255,255,255,0.5);">
                    <i class="fas fa-newspaper"></i> Noticias
                </a>
            </div>
        </div>
    </div>
</section>

<!-- CARRUSEL DE OFERTAS PREMIUM -->
{% if ofertas_activas and ofertas_activas|length > 0 %}
<div class="section-modern" style="padding-top: 24px; padding-bottom: 24px;">
    <div class="container-modern">
        <div id="ofertasCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000" style="border-radius: var(--radius-xl); overflow: hidden; box-shadow: var(--shadow-lg);">
            <div class="carousel-inner" style="border-radius: var(--radius-xl); overflow: hidden;">
            {% for oferta in ofertas_activas %}
            <div class="carousel-item {% if loop.first %}active{% endif %}" style="cursor: pointer;" onclick="window.location.href='/negocio/{{ oferta.negocio_id }}'">
                <div class="position-relative">
                    <img src="{{ get_safe_image_url(oferta.imagen_url) }}" class="d-block w-100" alt="{{ oferta.titulo }}" style="height: 300px; object-fit: cover;">
                    <!-- Overlay con informaciÃ³n (visible en todos los tamaÃ±os) -->
                    <div class="position-absolute bottom-0 start-0 end-0" style="background: linear-gradient(to top, rgba(0,0,0,0.85), rgba(0,0,0,0.5), transparent); padding: 15px 20px;">
                        <h5 class="fw-bold text-white mb-1">{{ oferta.titulo }}</h5>
                        {% if oferta.descripcion %}
                        <p class="text-white mb-1" style="font-size: 0.9rem; line-height: 1.3;">{{ oferta.descripcion[:80] }}{% if oferta.descripcion|length > 80 %}...{% endif %}</p>
                        {% endif %}
                        <small class="text-white-50 d-block mt-1">
                            <i class="far fa-calendar-alt me-1"></i>VÃ¡lido hasta: {{ oferta.fecha_caducidad.strftime('%d/%m/%Y') }}
                        </small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% if ofertas_activas|length > 1 %}
        <button class="carousel-control-prev" type="button" data-bs-target="#ofertasCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#ofertasCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Siguiente</span>
        </button>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- BUSCADOR PREMIUM -->
<div class="section-modern" style="padding-top: 48px; padding-bottom: 24px;">
    <div class="container-modern">
        <form method="get" class="row g-3">
            <div class="col-md-5">
                <div class="search-bar-premium">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" name="q" placeholder="Â¿QuÃ© estÃ¡s buscando?"
                           value="{{ request.args.get('q','') }}">
                </div>
            </div>

            <div class="col-md-4">
                <select name="cat" class="form-select" style="padding: 16px 20px; border: 2px solid var(--gray-300); border-radius: var(--radius-xl); font-size: 1rem; transition: all var(--transition-base);">
                <option value="Todas" {% if categoria_actual == 'Todas' %}selected{% endif %}>Todas las categorÃ­as</option>
                
                <optgroup label="ğŸ½ï¸ Comida y Bebidas">
                    <option value="Sodas y Rest." {% if categoria_actual == 'Sodas y Rest.' %}selected{% endif %}>ğŸ´ Sodas y Rest.</option>
                    <option value="Comida RÃ¡pida" {% if categoria_actual == 'Comida RÃ¡pida' %}selected{% endif %}>ğŸ• Comida RÃ¡pida</option>
                    <option value="CafeterÃ­as" {% if categoria_actual == 'CafeterÃ­as' %}selected{% endif %}>â˜• CafeterÃ­as</option>
                    <option value="Bares y Licores" {% if categoria_actual == 'Bares y Licores' %}selected{% endif %}>ğŸº Bares y Licores</option>
                    <option value="HeladerÃ­as" {% if categoria_actual == 'HeladerÃ­as' %}selected{% endif %}>ğŸ¦ HeladerÃ­as</option>
                    <option value="Restaurante" {% if categoria_actual == 'Restaurante' %}selected{% endif %}>ğŸ” Restaurantes</option>
                </optgroup>
                
                <optgroup label="ğŸ›’ Alimentos">
                    <option value="VerdurerÃ­as" {% if categoria_actual == 'VerdurerÃ­as' %}selected{% endif %}>ğŸ¥¬ VerdurerÃ­as</option>
                    <option value="CarnicerÃ­as" {% if categoria_actual == 'CarnicerÃ­as' %}selected{% endif %}>ğŸ¥© CarnicerÃ­as</option>
                    <option value="PanaderÃ­as" {% if categoria_actual == 'PanaderÃ­as' %}selected{% endif %}>ğŸ¥ PanaderÃ­as</option>
                    <option value="Super y Pulpes" {% if categoria_actual == 'Super y Pulpes' %}selected{% endif %}>ğŸ›’ Super y Pulpes</option>
                </optgroup>
                
                <optgroup label="ğŸ¥ Salud">
                    <option value="Farmacias" {% if categoria_actual == 'Farmacias' %}selected{% endif %}>ğŸ’Š Farmacias</option>
                    <option value="ClÃ­nicas y Dr." {% if categoria_actual == 'ClÃ­nicas y Dr.' %}selected{% endif %}>ğŸ©º ClÃ­nicas y Dr.</option>
                    <option value="Dentistas" {% if categoria_actual == 'Dentistas' %}selected{% endif %}>ğŸ¦· Dentistas</option>
                    <option value="Laboratorios" {% if categoria_actual == 'Laboratorios' %}selected{% endif %}>ğŸ§ª Laboratorios</option>
                    <option value="Veterinarias" {% if categoria_actual == 'Veterinarias' %}selected{% endif %}>ğŸ¾ Veterinarias</option>
                    <option value="Ã“pticas" {% if categoria_actual == 'Ã“pticas' %}selected{% endif %}>ğŸ‘“ Ã“pticas</option>
                    <option value="CCSS" {% if categoria_actual == 'CCSS' %}selected{% endif %}>ğŸ¥ CCSS / ClÃ­nica / EbÃ¡is</option>
                </optgroup>
                
                <optgroup label="ğŸ’… Belleza y Fitness">
                    <option value="Gimnasios" {% if categoria_actual == 'Gimnasios' %}selected{% endif %}>ğŸ’ª Gimnasios</option>
                    <option value="Spas y Masajes" {% if categoria_actual == 'Spas y Masajes' %}selected{% endif %}>ğŸ§˜ Spas y Masajes</option>
                    <option value="Belleza y BarberÃ­a" {% if categoria_actual == 'Belleza y BarberÃ­a' %}selected{% endif %}>âœ‚ï¸ Belleza y BarberÃ­a</option>
                </optgroup>
                
                <optgroup label="ğŸ‘• Ropa y TecnologÃ­a">
                    <option value="Ropa y Calzado" {% if categoria_actual == 'Ropa y Calzado' %}selected{% endif %}>ğŸ‘— Ropa y Calzado</option>
                    <option value="TecnologÃ­a y Cel." {% if categoria_actual == 'TecnologÃ­a y Cel.' %}selected{% endif %}>ğŸ“± TecnologÃ­a y Cel.</option>
                    <option value="Reparaciones Tech" {% if categoria_actual == 'Reparaciones Tech' %}selected{% endif %}>ğŸ’» Reparaciones Tech</option>
                </optgroup>
                
                <optgroup label="ğŸ”§ ConstrucciÃ³n y Automotriz">
                    <option value="FerreterÃ­as" {% if categoria_actual == 'FerreterÃ­as' %}selected{% endif %}>ğŸ”¨ FerreterÃ­as</option>
                    <option value="Materiales ConstrucciÃ³n" {% if categoria_actual == 'Materiales ConstrucciÃ³n' %}selected{% endif %}>ğŸ§± Materiales ConstrucciÃ³n</option>
                    <option value="MecÃ¡nica y Llantas" {% if categoria_actual == 'MecÃ¡nica y Llantas' %}selected{% endif %}>ğŸ”§ MecÃ¡nica y Llantas</option>
                    <option value="Transporte" {% if categoria_actual == 'Transporte' %}selected{% endif %}>ğŸš• Transporte</option>
                    <option value="Gasolineras" {% if categoria_actual == 'Gasolineras' %}selected{% endif %}>â›½ Gasolineras</option>
                    <option value="Automotriz" {% if categoria_actual == 'Automotriz' %}selected{% endif %}>ğŸš— Automotriz</option>
                </optgroup>
                
                <optgroup label="ğŸ“š EducaciÃ³n y Cultura">
                    <option value="LibrerÃ­as y Bazar" {% if categoria_actual == 'LibrerÃ­as y Bazar' %}selected{% endif %}>ğŸ“– LibrerÃ­as y Bazar</option>
                    <option value="Escuelas" {% if categoria_actual == 'Escuelas' %}selected{% endif %}>ğŸ« Escuelas</option>
                    <option value="Bibliotecas" {% if categoria_actual == 'Bibliotecas' %}selected{% endif %}>ğŸ“š Bibliotecas</option>
                    <option value="Academias" {% if categoria_actual == 'Academias' %}selected{% endif %}>ğŸ“ Academias</option>
                    <option value="Educacion" {% if categoria_actual == 'Educacion' %}selected{% endif %}>ğŸ“ EducaciÃ³n</option>
                </optgroup>
                
                <optgroup label="ğŸ¨ Turismo y Entretenimiento">
                    <option value="Hoteles y Hospedaje" {% if categoria_actual == 'Hoteles y Hospedaje' %}selected{% endif %}>ğŸ¨ Hoteles y Hospedaje</option>
                    <option value="Parques" {% if categoria_actual == 'Parques' %}selected{% endif %}>ğŸŒ³ Parques</option>
                    <option value="Plazas" {% if categoria_actual == 'Plazas' %}selected{% endif %}>ğŸï¸ Plazas</option>
                    <option value="Polideportivo" {% if categoria_actual == 'Polideportivo' %}selected{% endif %}>ğŸŸï¸ Polideportivos</option>
                    <option value="Cines y Entretenimiento" {% if categoria_actual == 'Cines y Entretenimiento' %}selected{% endif %}>ğŸ¬ Cines y Entretenimiento</option>
                    <option value="Turismo" {% if categoria_actual == 'Turismo' %}selected{% endif %}>ğŸ—ºï¸ Turismo</option>
                </optgroup>
                
                <optgroup label="ğŸ’° Finanzas">
                    <option value="Bancos" {% if categoria_actual == 'Bancos' %}selected{% endif %}>ğŸ¦ Bancos</option>
                    <option value="Cooperativas" {% if categoria_actual == 'Cooperativas' %}selected{% endif %}>ğŸ’µ Cooperativas</option>
                </optgroup>
                
                <optgroup label="ğŸ›ï¸ Servicios PÃºblicos">
                    <option value="Cruz Roja" {% if categoria_actual == 'Cruz Roja' %}selected{% endif %}>ğŸš‘ Cruz Roja</option>
                    <option value="Bomberos" {% if categoria_actual == 'Bomberos' %}selected{% endif %}>ğŸš’ Bomberos</option>
                    <option value="PolicÃ­a" {% if categoria_actual == 'PolicÃ­a' %}selected{% endif %}>ğŸš“ PolicÃ­a</option>
                    <option value="Municipalidad" {% if categoria_actual == 'Municipalidad' %}selected{% endif %}>ğŸ›ï¸ Municipalidad</option>
                    <option value="Iglesia" {% if categoria_actual == 'Iglesia' %}selected{% endif %}>â›ª Iglesias</option>
                    <option value="Instituciones PÃºblicas" {% if categoria_actual == 'Instituciones PÃºblicas' %}selected{% endif %}>ğŸ¢ Instituciones PÃºblicas</option>
                    <option value="Edificio Gubernamental" {% if categoria_actual == 'Edificio Gubernamental' %}selected{% endif %}>ğŸ¢ Edificio Gubernamental</option>
                </optgroup>
                
                <optgroup label="ğŸ’¼ Servicios Profesionales">
                    <option value="Servicios Pro" {% if categoria_actual == 'Servicios Pro' %}selected{% endif %}>ğŸ’¼ Servicios Pro</option>
                    <option value="ConsultorÃ­a" {% if categoria_actual == 'ConsultorÃ­a' %}selected{% endif %}>ğŸ“Š ConsultorÃ­a</option>
                    <option value="Abogados" {% if categoria_actual == 'Abogados' %}selected{% endif %}>âš–ï¸ Abogados</option>
                    <option value="Contables" {% if categoria_actual == 'Contables' %}selected{% endif %}>ğŸ“‹ Contables</option>
                    <option value="Salones de Eventos" {% if categoria_actual == 'Salones de Eventos' %}selected{% endif %}>ğŸ‰ Salones de Eventos</option>
                    <option value="Mudanzas y Transporte" {% if categoria_actual == 'Mudanzas y Transporte' %}selected{% endif %}>ğŸšš Mudanzas y Transporte</option>
                    <option value="PlomerÃ­a y Electricidad" {% if categoria_actual == 'PlomerÃ­a y Electricidad' %}selected{% endif %}>âš¡ PlomerÃ­a y Electricidad</option>
                    <option value="JardinerÃ­a" {% if categoria_actual == 'JardinerÃ­a' %}selected{% endif %}>ğŸŒ± JardinerÃ­a</option>
                    <option value="Mascotas y Suministros" {% if categoria_actual == 'Mascotas y Suministros' %}selected{% endif %}>ğŸ• Mascotas y Suministros</option>
                    <option value="Servicios" {% if categoria_actual == 'Servicios' %}selected{% endif %}>ğŸ§° Servicios</option>
                </optgroup>
                
                <optgroup label="ğŸª Otros">
                    <option value="Comercio" {% if categoria_actual == 'Comercio' %}selected{% endif %}>ğŸª Comercios</option>
                    <option value="Otros" {% if categoria_actual == 'Otros' %}selected{% endif %}>âœ¨ Otros</option>
                </optgroup>
            </select>
        </div>

            <div class="col-md-3">
                <button type="submit" class="btn-modern btn-modern-primary w-100">
                    <i class="fas fa-search me-2"></i>Buscar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- RESULTADOS -->
<div class="section-modern" style="padding-top: 24px;">
    <div class="container-modern">
        <div class="row g-4">
            {% for n in negocios %}
            <div class="col-md-4 col-sm-6">
                <a href="/negocio/{{ n.id }}" class="text-decoration-none" style="color: inherit;">
                    <div class="card-modern animate-fade-in-up">
                        <img src="{{ get_safe_image_url(n.imagen_url) if get_safe_image_url else (n.imagen_url if n.imagen_url else 'https://via.placeholder.com/600x400?text=Ubik2CR') }}"
                             class="card-modern-image"
                             alt="{{ n.nombre }}"
                             onerror="if(this.src.indexOf('placeholder') === -1) { this.src='https://via.placeholder.com/600x400?text=Ubik2CR'; this.onerror=null; }"
                             loading="lazy">
                        <div class="card-modern-body">
                            <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
                                <span class="badge-modern">{{ n.categoria }}</span>
                                {% if n.es_vip %}
                                <span class="badge-modern" style="background: linear-gradient(135deg, #FFB800, #FFD700); color: #000;">â­ VIP</span>
                                {% endif %}
                            </div>
                            <h5 class="card-modern-title">{{ n.nombre }}</h5>
                            <p class="card-modern-text">
                                <i class="fas fa-map-marker-alt me-1" style="color: var(--gray-500); font-size: 0.875rem;"></i>
                                {{ n.ubicacion }}
                            </p>
                            {% if n.calificacion and n.calificacion > 0 %}
                            <div class="mb-3">
                                <div class="d-flex align-items-center gap-1 mb-1">
                                    {% for i in range(5) %}
                                        {% if i < n.calificacion|int %}
                                            <i class="fas fa-star" style="color: #FFB800; font-size: 0.875rem;"></i>
                                        {% elif i < n.calificacion|round %}
                                            <i class="fas fa-star-half-alt" style="color: #FFB800; font-size: 0.875rem;"></i>
                                        {% else %}
                                            <i class="far fa-star" style="color: var(--gray-300); font-size: 0.875rem;"></i>
                                        {% endif %}
                                    {% endfor %}
                                    <span style="color: var(--gray-600); font-size: 0.875rem; font-weight: 600; margin-left: 4px;">
                                        {{ n.calificacion }}
                                    </span>
                                    <span style="color: var(--gray-500); font-size: 0.8125rem; margin-left: 4px;">
                                        ({{ n.total_votos }})
                                    </span>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="card-modern-footer">
                            <span class="btn-modern btn-modern-primary" style="width: 100%; justify-content: center;">
                                Ver detalles <i class="fas fa-arrow-right ms-2"></i>
                            </span>
                        </div>
                    </div>
                </a>
            </div>
            {% else %}
            <div class="col-12">
                <div class="card-modern text-center" style="padding: 64px 32px;">
                    <i class="fas fa-search" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 16px;"></i>
                    <h5 class="mb-2" style="color: var(--gray-700);">AÃºn no hay resultados</h5>
                    <p style="color: var(--gray-600);">ProbÃ¡ con otra bÃºsqueda o seleccionÃ¡ "Todas las categorÃ­as".</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- FOOTER PREMIUM -->
<footer style="background: var(--secondary); color: rgba(255,255,255,0.8); padding: 48px 0; margin-top: 64px;">
    <div class="container-modern text-center">
        <p style="margin: 0; font-size: 0.9375rem;">Â© 2025 Ubik2CR â€” Todos los derechos reservados</p>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

