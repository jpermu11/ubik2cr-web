<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Ubik2CR - Tu cant√≥n en tu mano</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body>

<!-- HEADER PREMIUM -->
<nav class="navbar-premium navbar-expand-lg">
    <div class="container-modern">
        <a class="navbar-brand-premium" href="/">
            <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR">
            <span class="d-none d-sm-inline">Ubik2CR</span>
        </a>

        <!-- Bot√≥n hamburger para m√≥vil -->
        <button class="navbar-toggler d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"
                style="border: 2px solid var(--gray-300); border-radius: var(--radius-md); padding: 8px 12px; background: transparent; color: var(--gray-700);">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Men√∫ colapsable -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center gap-2 flex-wrap">
                <li class="nav-item">
                    <a href="/noticias" class="nav-link-premium">
                        <i class="fas fa-newspaper me-1"></i><span>Noticias</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/cuenta" class="nav-link-premium">
                        <i class="fas fa-user me-1"></i><span>Cuenta</span>
                    </a>
                </li>
                {% if session.get('user_id') %}
                <li class="nav-item">
                    <a href="/favoritos" class="nav-link-premium">
                        <i class="fas fa-heart me-1"></i><span>Favoritos</span>
                    </a>
                </li>
                {% endif %}
                {% if session.get('admin_logged_in') %}
                <li class="nav-item">
                    <a href="/admin" class="btn-modern btn-modern-primary">
                        <i class="fas fa-cog me-1"></i><span>Panel Admin</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/logout" class="btn-modern btn-modern-ghost">
                        <i class="fas fa-sign-out-alt me-1"></i><span>Salir</span>
                    </a>
                </li>
                {% else %}
                <li class="nav-item">
                    <a href="/login" class="btn-modern btn-modern-primary">
                        <i class="fas fa-lock me-1"></i><span>Administraci√≥n</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<!-- HERO PREMIUM -->
<section class="hero-premium">
    <div class="container-modern text-center">
        <div class="animate-fade-in-up">
            <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR" style="max-width: 400px; width: 100%; height: auto; margin-bottom: 24px; filter: brightness(0) invert(1);">
            <h1>Tu cant√≥n en tu mano</h1>
            <p>Descubr√≠ los mejores negocios, servicios y lugares de tu comunidad</p>

            <div class="d-flex gap-3 justify-content-center flex-wrap mt-4">
                <a href="/mapa" class="btn-modern btn-modern-secondary" style="background: rgba(255,255,255,0.15); color: white; border-color: rgba(255,255,255,0.3); text-decoration: none; position: relative; z-index: 10; pointer-events: auto;">
                    <i class="fas fa-map-marker-alt"></i> <span>Ver en mapa</span>
                </a>
                <a href="/noticias" class="btn-modern btn-modern-outline" style="background: rgba(255,255,255,0.1); color: white; border-color: rgba(255,255,255,0.5); text-decoration: none; position: relative; z-index: 10; pointer-events: auto;">
                    <i class="fas fa-newspaper"></i> <span>Noticias</span>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- SECCI√ìN DE NOTICIAS Y OFERTAS (DISE√ëO COMPACTO) -->
<div class="section-modern" style="padding-top: 32px; padding-bottom: 32px; background: linear-gradient(180deg, rgba(11, 79, 163, 0.03), rgba(56, 178, 77, 0.03));">
    <div class="container-modern">
        <div class="row g-4">
            
            <!-- NOTICIAS DE LA COMUNIDAD (Columna Izquierda) -->
            {% if noticias_recientes and noticias_recientes|length > 0 %}
            <div class="col-lg-6">
                <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
                    <div>
                        <h3 class="fw-bold mb-1" style="color: var(--brand-blue); font-size: 1.5rem;">
                            <i class="fas fa-newspaper me-2" style="color: var(--brand-blue);"></i>Noticias
                        </h3>
                        <p class="text-muted mb-0 small">Novedades y eventos</p>
                    </div>
                    <a href="/noticias" class="btn btn-outline-primary btn-sm fw-bold">
                        Ver todas <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
                
                <div id="noticiasCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000" 
                     style="border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-md); touch-action: pan-y; background: white; height: 200px;">
                    <div class="carousel-inner" style="border-radius: var(--radius-lg); overflow: hidden; height: 200px;">
                    {% for noticia in noticias_recientes %}
                    <div class="carousel-item {% if loop.first %}active{% endif %}" 
                         style="cursor: pointer; touch-action: manipulation; height: 200px;" 
                         onclick="window.location.href='/noticia/{{ noticia.id }}'"
                         ontouchstart="this.style.opacity='0.9'" 
                         ontouchend="this.style.opacity='1'">
                        <div class="position-relative d-flex" style="height: 200px; overflow: hidden;">
                            {% if noticia.imagen_url %}
                            <div style="width: 180px; height: 200px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <img src="{{ get_safe_image_url(noticia.imagen_url) }}" 
                                     class="d-block" 
                                     alt="{{ noticia.titulo }}" 
                                     style="max-width: 180px; max-height: 200px; width: auto; height: auto; object-fit: contain;"
                                     onerror="if(this.src.indexOf('placeholder') === -1) { this.src='https://via.placeholder.com/180x200?text=Ubik2CR'; this.onerror=null; }"
                                     loading="lazy">
                            </div>
                            {% else %}
                            <div style="width: 180px; height: 200px; background: linear-gradient(135deg, var(--brand-blue-lightest), #e8f0f8); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <i class="fas fa-newspaper" style="font-size: 2.5rem; color: var(--brand-blue); opacity: 0.3;"></i>
                            </div>
                            {% endif %}
                            <!-- Contenido de texto -->
                            <div class="flex-grow-1 p-3 d-flex flex-column justify-content-between" style="background: white;">
                                <div>
                                    <h5 class="fw-bold mb-2" style="color: var(--brand-blue); font-size: 1.1rem; line-height: 1.3;">{{ noticia.titulo }}</h5>
                                    <p class="text-muted mb-0 small" style="font-size: 0.875rem; line-height: 1.4; -webkit-line-clamp: 3; display: -webkit-box; -webkit-box-orient: vertical; overflow: hidden;">
                                        {{ noticia.contenido[:100] }}{% if noticia.contenido|length > 100 %}...{% endif %}
                                    </p>
                                </div>
                                <small class="text-muted d-flex align-items-center" style="font-size: 0.75rem;">
                                    <i class="far fa-calendar-alt me-1"></i>
                                    <span>{{ noticia.fecha.strftime('%d/%m/%Y') }}</span>
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    </div>
                    <!-- Botones de compartir y descargar noticias -->
                    <div class="d-flex gap-2 justify-content-center mt-2 flex-wrap" style="padding: 0 8px;">
                        {% if noticias_recientes|length > 0 %}
                        <button type="button" class="btn btn-sm btn-outline-primary" 
                                onclick="event.stopPropagation(); compartirNoticia({{ noticias_recientes[0].id }}, '{{ noticias_recientes[0].titulo|e }}');"
                                style="font-size: 0.75rem; padding: 4px 8px; min-height: 32px; border-radius: 6px;">
                            <i class="fas fa-share-alt me-1"></i> Compartir Noticia
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-success" 
                                onclick="event.stopPropagation(); descargarNoticia({{ noticias_recientes[0].id }});"
                                style="font-size: 0.75rem; padding: 4px 8px; min-height: 32px; border-radius: 6px;">
                            <i class="fas fa-download me-1"></i> Obtener Noticia
                        </button>
                        {% endif %}
                    </div>
                    {% if noticias_recientes|length > 1 %}
                    <button class="carousel-control-prev" type="button" data-bs-target="#noticiasCarousel" data-bs-slide="prev"
                            style="min-width: 40px; min-height: 40px; width: 40px; height: 40px; background: rgba(255,255,255,0.95); border-radius: 50%; top: 50%; transform: translateY(-50%); left: 10px; opacity: 0.9; touch-action: manipulation; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                        <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: invert(1); opacity: 0.7;"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#noticiasCarousel" data-bs-slide="next"
                            style="min-width: 40px; min-height: 40px; width: 40px; height: 40px; background: rgba(255,255,255,0.95); border-radius: 50%; top: 50%; transform: translateY(-50%); right: 10px; opacity: 0.9; touch-action: manipulation; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                        <span class="carousel-control-next-icon" aria-hidden="true" style="filter: invert(1); opacity: 0.7;"></span>
                        <span class="visually-hidden">Siguiente</span>
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- OFERTAS ESPECIALES (Columna Derecha) -->
            {% if ofertas_activas and ofertas_activas|length > 0 %}
            <div class="col-lg-6">
                <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
                    <div>
                        <h3 class="fw-bold mb-1" style="color: var(--brand-green); font-size: 1.5rem;">
                            <i class="fas fa-tags me-2" style="color: var(--brand-green);"></i>Ofertas
                        </h3>
                        <p class="text-muted mb-0 small">Promociones especiales</p>
                    </div>
                    <a href="/" class="btn btn-outline-success btn-sm fw-bold" style="border-color: var(--brand-green); color: var(--brand-green);">
                        Ver todas <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
                
                <div id="ofertasCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4500" 
                     style="border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-md); touch-action: pan-y; background: white; height: 200px;">
                    <div class="carousel-inner" style="border-radius: var(--radius-lg); overflow: hidden; height: 200px;">
                    {% for oferta in ofertas_activas %}
                    <div class="carousel-item {% if loop.first %}active{% endif %}" 
                         style="cursor: pointer; touch-action: manipulation; height: 200px;" 
                         onclick="window.location.href='/oferta/{{ oferta.id }}'"
                         ontouchstart="this.style.opacity='0.9'" 
                         ontouchend="this.style.opacity='1'">
                        <div class="position-relative d-flex" style="height: 200px; overflow: hidden;">
                            <div style="width: 180px; height: 200px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <img src="{{ get_safe_image_url(oferta.imagen_url) }}" 
                                     class="d-block" 
                                     alt="{{ oferta.titulo }}" 
                                     style="max-width: 180px; max-height: 200px; width: auto; height: auto; object-fit: contain;"
                                     loading="lazy">
                            </div>
                            <!-- Contenido de texto -->
                            <div class="flex-grow-1 p-3 d-flex flex-column justify-content-between" style="background: white;">
                                <div>
                                    <h5 class="fw-bold mb-2" style="color: var(--brand-green); font-size: 1.1rem; line-height: 1.3;">{{ oferta.titulo }}</h5>
                                    {% if oferta.descripcion %}
                                    <p class="text-muted mb-0 small" style="font-size: 0.875rem; line-height: 1.4; -webkit-line-clamp: 3; display: -webkit-box; -webkit-box-orient: vertical; overflow: hidden;">
                                        {{ oferta.descripcion[:100] }}{% if oferta.descripcion|length > 100 %}...{% endif %}
                                    </p>
                                    {% endif %}
                                </div>
                                <small class="text-muted d-flex align-items-center" style="font-size: 0.75rem;">
                                    <i class="far fa-calendar-alt me-1"></i>
                                    <span>V√°lido hasta: {{ oferta.fecha_caducidad.strftime('%d/%m/%Y') }}</span>
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    </div>
                    <!-- Botones de compartir y descargar ofertas -->
                    <div class="d-flex gap-2 justify-content-center mt-2 flex-wrap" style="padding: 0 8px;">
                        {% if ofertas_activas|length > 0 %}
                        <button type="button" class="btn btn-sm btn-outline-success" 
                                onclick="event.stopPropagation(); compartirOferta({{ ofertas_activas[0].id }}, {{ ofertas_activas[0].negocio_id }}, '{{ ofertas_activas[0].titulo|e }}');"
                                style="font-size: 0.75rem; padding: 4px 8px; min-height: 32px; border-radius: 6px; border-color: var(--brand-green); color: var(--brand-green);">
                            <i class="fas fa-share-alt me-1"></i> Compartir Oferta
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-success" 
                                onclick="event.stopPropagation(); descargarOferta({{ ofertas_activas[0].id }});"
                                style="font-size: 0.75rem; padding: 4px 8px; min-height: 32px; border-radius: 6px; border-color: var(--brand-green); color: var(--brand-green);">
                            <i class="fas fa-download me-1"></i> Obtener Oferta
                        </button>
                        {% endif %}
                    </div>
                    {% if ofertas_activas|length > 1 %}
                    <button class="carousel-control-prev" type="button" data-bs-target="#ofertasCarousel" data-bs-slide="prev"
                            style="min-width: 40px; min-height: 40px; width: 40px; height: 40px; background: rgba(255,255,255,0.95); border-radius: 50%; top: 50%; transform: translateY(-50%); left: 10px; opacity: 0.9; touch-action: manipulation; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                        <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: invert(1); opacity: 0.7;"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#ofertasCarousel" data-bs-slide="next"
                            style="min-width: 40px; min-height: 40px; width: 40px; height: 40px; background: rgba(255,255,255,0.95); border-radius: 50%; top: 50%; transform: translateY(-50%); right: 10px; opacity: 0.9; touch-action: manipulation; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                        <span class="carousel-control-next-icon" aria-hidden="true" style="filter: invert(1); opacity: 0.7;"></span>
                        <span class="visually-hidden">Siguiente</span>
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
        </div>
    </div>
</div>

<!-- BUSCADOR PREMIUM -->
<div class="section-modern" style="padding-top: 48px; padding-bottom: 24px;">
    <div class="container-modern">
        <form method="get" class="row g-3" id="searchForm">
            <div class="col-12 col-md-5">
                <div class="search-bar-premium">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" name="q" placeholder="Ej: shampoo, comida, medicina, gasolina..."
                           value="{{ q if q else '' }}" 
                           autocomplete="off"
                           id="searchInput"
                           style="width: 100%;">
                </div>
            </div>

            <div class="col-12 col-md-4">
                <select name="cat" class="form-select custom-select-arrow">
                <option value="Todas" {% if categoria_actual == 'Todas' %}selected{% endif %}>Todas las categor√≠as</option>
                
                <optgroup label="üçΩÔ∏è Comida y Bebidas">
                    <option value="Sodas y Rest." {% if categoria_actual == 'Sodas y Rest.' %}selected{% endif %}>üç¥ Sodas y Rest.</option>
                    <option value="Comida R√°pida" {% if categoria_actual == 'Comida R√°pida' %}selected{% endif %}>üçï Comida R√°pida</option>
                    <option value="Cafeter√≠as" {% if categoria_actual == 'Cafeter√≠as' %}selected{% endif %}>‚òï Cafeter√≠as</option>
                    <option value="Bares y Licores" {% if categoria_actual == 'Bares y Licores' %}selected{% endif %}>üç∫ Bares y Licores</option>
                    <option value="Helader√≠as" {% if categoria_actual == 'Helader√≠as' %}selected{% endif %}>üç¶ Helader√≠as</option>
                    <option value="Restaurante" {% if categoria_actual == 'Restaurante' %}selected{% endif %}>üçî Restaurantes</option>
                </optgroup>
                
                <optgroup label="üõí Alimentos">
                    <option value="Verdurer√≠as" {% if categoria_actual == 'Verdurer√≠as' %}selected{% endif %}>ü•¨ Verdurer√≠as</option>
                    <option value="Carnicer√≠as" {% if categoria_actual == 'Carnicer√≠as' %}selected{% endif %}>ü•© Carnicer√≠as</option>
                    <option value="Panader√≠as" {% if categoria_actual == 'Panader√≠as' %}selected{% endif %}>ü•ê Panader√≠as</option>
                    <option value="Super y Pulpes" {% if categoria_actual == 'Super y Pulpes' %}selected{% endif %}>üõí Super y Pulpes</option>
                </optgroup>
                
                <optgroup label="üè• Salud">
                    <option value="Farmacias" {% if categoria_actual == 'Farmacias' %}selected{% endif %}>üíä Farmacias</option>
                    <option value="Cl√≠nicas y Dr." {% if categoria_actual == 'Cl√≠nicas y Dr.' %}selected{% endif %}>ü©∫ Cl√≠nicas y Dr.</option>
                    <option value="Dentistas" {% if categoria_actual == 'Dentistas' %}selected{% endif %}>ü¶∑ Dentistas</option>
                    <option value="Laboratorios" {% if categoria_actual == 'Laboratorios' %}selected{% endif %}>üß™ Laboratorios</option>
                    <option value="Veterinarias" {% if categoria_actual == 'Veterinarias' %}selected{% endif %}>üêæ Veterinarias</option>
                    <option value="√ìpticas" {% if categoria_actual == '√ìpticas' %}selected{% endif %}>üëì √ìpticas</option>
                    <option value="CCSS" {% if categoria_actual == 'CCSS' %}selected{% endif %}>üè• CCSS / Cl√≠nica / Eb√°is</option>
                </optgroup>
                
                <optgroup label="üíÖ Belleza y Fitness">
                    <option value="Gimnasios" {% if categoria_actual == 'Gimnasios' %}selected{% endif %}>üí™ Gimnasios</option>
                    <option value="Spas y Masajes" {% if categoria_actual == 'Spas y Masajes' %}selected{% endif %}>üßò Spas y Masajes</option>
                    <option value="Belleza y Barber√≠a" {% if categoria_actual == 'Belleza y Barber√≠a' %}selected{% endif %}>‚úÇÔ∏è Belleza y Barber√≠a</option>
                </optgroup>
                
                <optgroup label="üëï Ropa y Tecnolog√≠a">
                    <option value="Ropa y Calzado" {% if categoria_actual == 'Ropa y Calzado' %}selected{% endif %}>üëó Ropa y Calzado</option>
                    <option value="Tecnolog√≠a y Cel." {% if categoria_actual == 'Tecnolog√≠a y Cel.' %}selected{% endif %}>üì± Tecnolog√≠a y Cel.</option>
                    <option value="Reparaciones Tech" {% if categoria_actual == 'Reparaciones Tech' %}selected{% endif %}>üíª Reparaciones Tech</option>
                </optgroup>
                
                <optgroup label="üîß Construcci√≥n y Automotriz">
                    <option value="Ferreter√≠as" {% if categoria_actual == 'Ferreter√≠as' %}selected{% endif %}>üî® Ferreter√≠as</option>
                    <option value="Materiales Construcci√≥n" {% if categoria_actual == 'Materiales Construcci√≥n' %}selected{% endif %}>üß± Materiales Construcci√≥n</option>
                    <option value="Mec√°nica y Llantas" {% if categoria_actual == 'Mec√°nica y Llantas' %}selected{% endif %}>üîß Mec√°nica y Llantas</option>
                    <option value="Transporte" {% if categoria_actual == 'Transporte' %}selected{% endif %}>üöï Transporte</option>
                    <option value="Gasolineras" {% if categoria_actual == 'Gasolineras' %}selected{% endif %}>‚õΩ Gasolineras</option>
                    <option value="Automotriz" {% if categoria_actual == 'Automotriz' %}selected{% endif %}>üöó Automotriz</option>
                </optgroup>
                
                <optgroup label="üìö Educaci√≥n y Cultura">
                    <option value="Librer√≠as y Bazar" {% if categoria_actual == 'Librer√≠as y Bazar' %}selected{% endif %}>üìñ Librer√≠as y Bazar</option>
                    <option value="Escuelas" {% if categoria_actual == 'Escuelas' %}selected{% endif %}>üè´ Escuelas</option>
                    <option value="Bibliotecas" {% if categoria_actual == 'Bibliotecas' %}selected{% endif %}>üìö Bibliotecas</option>
                    <option value="Academias" {% if categoria_actual == 'Academias' %}selected{% endif %}>üéì Academias</option>
                    <option value="Educacion" {% if categoria_actual == 'Educacion' %}selected{% endif %}>üéì Educaci√≥n</option>
                </optgroup>
                
                <optgroup label="üè® Turismo y Entretenimiento">
                    <option value="Hoteles y Hospedaje" {% if categoria_actual == 'Hoteles y Hospedaje' %}selected{% endif %}>üè® Hoteles y Hospedaje</option>
                    <option value="Parques" {% if categoria_actual == 'Parques' %}selected{% endif %}>üå≥ Parques</option>
                    <option value="Plazas" {% if categoria_actual == 'Plazas' %}selected{% endif %}>üèûÔ∏è Plazas</option>
                    <option value="Polideportivo" {% if categoria_actual == 'Polideportivo' %}selected{% endif %}>üèüÔ∏è Polideportivos</option>
                    <option value="Cines y Entretenimiento" {% if categoria_actual == 'Cines y Entretenimiento' %}selected{% endif %}>üé¨ Cines y Entretenimiento</option>
                    <option value="Turismo" {% if categoria_actual == 'Turismo' %}selected{% endif %}>üó∫Ô∏è Turismo</option>
                </optgroup>
                
                <optgroup label="üí∞ Finanzas">
                    <option value="Bancos" {% if categoria_actual == 'Bancos' %}selected{% endif %}>üè¶ Bancos</option>
                    <option value="Cooperativas" {% if categoria_actual == 'Cooperativas' %}selected{% endif %}>üíµ Cooperativas</option>
                </optgroup>
                
                <optgroup label="üèõÔ∏è Servicios P√∫blicos">
                    <option value="Cruz Roja" {% if categoria_actual == 'Cruz Roja' %}selected{% endif %}>üöë Cruz Roja</option>
                    <option value="Bomberos" {% if categoria_actual == 'Bomberos' %}selected{% endif %}>üöí Bomberos</option>
                    <option value="Polic√≠a" {% if categoria_actual == 'Polic√≠a' %}selected{% endif %}>üöì Polic√≠a</option>
                    <option value="Municipalidad" {% if categoria_actual == 'Municipalidad' %}selected{% endif %}>üèõÔ∏è Municipalidad</option>
                    <option value="Iglesia" {% if categoria_actual == 'Iglesia' %}selected{% endif %}>‚õ™ Iglesias</option>
                    <option value="Instituciones P√∫blicas" {% if categoria_actual == 'Instituciones P√∫blicas' %}selected{% endif %}>üè¢ Instituciones P√∫blicas</option>
                    <option value="Edificio Gubernamental" {% if categoria_actual == 'Edificio Gubernamental' %}selected{% endif %}>üè¢ Edificio Gubernamental</option>
                </optgroup>
                
                <optgroup label="üíº Servicios Profesionales">
                    <option value="Servicios Pro" {% if categoria_actual == 'Servicios Pro' %}selected{% endif %}>üíº Servicios Pro</option>
                    <option value="Consultor√≠a" {% if categoria_actual == 'Consultor√≠a' %}selected{% endif %}>üìä Consultor√≠a</option>
                    <option value="Abogados" {% if categoria_actual == 'Abogados' %}selected{% endif %}>‚öñÔ∏è Abogados</option>
                    <option value="Contables" {% if categoria_actual == 'Contables' %}selected{% endif %}>üìã Contables</option>
                    <option value="Salones de Eventos" {% if categoria_actual == 'Salones de Eventos' %}selected{% endif %}>üéâ Salones de Eventos</option>
                    <option value="Mudanzas y Transporte" {% if categoria_actual == 'Mudanzas y Transporte' %}selected{% endif %}>üöö Mudanzas y Transporte</option>
                    <option value="Plomer√≠a y Electricidad" {% if categoria_actual == 'Plomer√≠a y Electricidad' %}selected{% endif %}>‚ö° Plomer√≠a y Electricidad</option>
                    <option value="Jardiner√≠a" {% if categoria_actual == 'Jardiner√≠a' %}selected{% endif %}>üå± Jardiner√≠a</option>
                    <option value="Mascotas y Suministros" {% if categoria_actual == 'Mascotas y Suministros' %}selected{% endif %}>üêï Mascotas y Suministros</option>
                    <option value="Servicios" {% if categoria_actual == 'Servicios' %}selected{% endif %}>üß∞ Servicios</option>
                </optgroup>
                
                <optgroup label="üè™ Otros">
                    <option value="Comercio" {% if categoria_actual == 'Comercio' %}selected{% endif %}>üè™ Comercios</option>
                    <option value="Otros" {% if categoria_actual == 'Otros' %}selected{% endif %}>‚ú® Otros</option>
                </optgroup>
            </select>
        </div>

            <div class="col-12 col-md-3">
                <button type="submit" class="btn-modern btn-modern-primary w-100" style="min-height: 52px;">
                    <i class="fas fa-search me-2"></i><span>Buscar</span>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- RESULTADOS -->
<div class="section-modern" style="padding-top: 24px;">
    <div class="container-modern">
        {% if q and categorias_inteligentes %}
        <div class="alert alert-info mb-4" style="background: linear-gradient(135deg, var(--brand-blue-lightest), #e8f0f8); border: 2px solid var(--brand-blue); border-radius: var(--radius-lg); padding: 16px 20px;">
            <div class="d-flex align-items-start gap-3">
                <i class="fas fa-lightbulb" style="color: var(--brand-blue); font-size: 1.5rem; margin-top: 2px;"></i>
                <div>
                    <strong style="color: var(--brand-blue); display: block; margin-bottom: 8px;">üîç B√∫squeda Inteligente Activada</strong>
                    <p style="margin: 0; color: var(--gray-700); font-size: 0.9375rem; line-height: 1.6;">
                        Buscando "<strong>{{ q }}</strong>" en negocios relacionados con: 
                        <span style="display: inline-flex; gap: 6px; flex-wrap: wrap; margin-top: 8px;">
                            {% for cat_int in categorias_inteligentes %}
                            <span class="badge" style="background: var(--brand-blue); color: white; padding: 6px 12px; border-radius: 20px; font-weight: 600;">{{ cat_int }}</span>
                            {% endfor %}
                        </span>
                    </p>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if q and negocios|length == 0 %}
        <div class="text-center py-5">
            <i class="fas fa-search" style="font-size: 4rem; color: var(--gray-400); margin-bottom: 20px;"></i>
            <h4 style="color: var(--gray-700); margin-bottom: 12px;">No se encontraron resultados</h4>
            <p style="color: var(--gray-600); margin-bottom: 24px;">No hay negocios que coincidan con "<strong>{{ q }}</strong>"</p>
            <a href="/" class="btn-modern btn-modern-primary">
                <i class="fas fa-home me-2"></i>Volver al inicio
            </a>
        </div>
        {% elif q %}
        <div class="mb-4">
            <h5 style="color: var(--gray-700); font-weight: 600;">
                Resultados para "<strong style="color: var(--brand-blue);">{{ q }}</strong>" 
                <span class="badge" style="background: var(--brand-blue); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.875rem; margin-left: 8px;">{{ negocios|length }}</span>
            </h5>
        </div>
        {% endif %}
        
        <div class="row g-4">
            {% for n in negocios %}
            <div class="col-md-4 col-sm-6">
                <a href="/negocio/{{ n.id }}" class="text-decoration-none" style="color: inherit;">
                    <div class="card-modern animate-fade-in-up">
                        <img src="{{ get_safe_image_url(n.imagen_url) if get_safe_image_url else (n.imagen_url if n.imagen_url else 'https://via.placeholder.com/600x400?text=Ubik2CR') }}"
                             class="card-modern-image"
                             alt="{{ n.nombre }}"
                             onerror="if(this.src.indexOf('placeholder') === -1) { this.src='https://via.placeholder.com/600x400?text=Ubik2CR'; this.onerror=null; }"
                             loading="lazy">
                        <div class="card-modern-body">
                            <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
                                <span class="badge-modern">{{ n.categoria }}</span>
                                {% if n.es_vip %}
                                <span class="badge-modern" style="background: linear-gradient(135deg, #FFB800, #FFD700); color: #000;">‚≠ê VIP</span>
                                {% endif %}
                            </div>
                            <h5 class="card-modern-title">{{ n.nombre }}</h5>
                            <p class="card-modern-text">
                                <i class="fas fa-map-marker-alt me-1" style="color: var(--gray-500); font-size: 0.875rem;"></i>
                                {{ n.ubicacion }}
                            </p>
                            {% if n.calificacion and n.calificacion > 0 %}
                            <div class="mb-3">
                                <div class="d-flex align-items-center gap-1 mb-1">
                                    {% for i in range(5) %}
                                        {% if i < n.calificacion|int %}
                                            <i class="fas fa-star" style="color: #FFB800; font-size: 0.875rem;"></i>
                                        {% elif i < n.calificacion|round %}
                                            <i class="fas fa-star-half-alt" style="color: #FFB800; font-size: 0.875rem;"></i>
                                        {% else %}
                                            <i class="far fa-star" style="color: var(--gray-300); font-size: 0.875rem;"></i>
                                        {% endif %}
                                    {% endfor %}
                                    <span style="color: var(--gray-600); font-size: 0.875rem; font-weight: 600; margin-left: 4px;">
                                        {{ n.calificacion }}
                                    </span>
                                    <span style="color: var(--gray-500); font-size: 0.8125rem; margin-left: 4px;">
                                        ({{ n.total_votos }})
                                    </span>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="card-modern-footer">
                            <span class="btn-modern btn-modern-primary" style="width: 100%; justify-content: center;">
                                Ver detalles <i class="fas fa-arrow-right ms-2"></i>
                            </span>
                        </div>
                    </div>
                </a>
            </div>
            {% else %}
            <div class="col-12">
                <div class="card-modern text-center" style="padding: 64px 32px;">
                    <i class="fas fa-search" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 16px;"></i>
                    <h5 class="mb-2" style="color: var(--gray-700);">A√∫n no hay resultados</h5>
                    <p style="color: var(--gray-600);">Prob√° con otra b√∫squeda o seleccion√° "Todas las categor√≠as".</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- SECCI√ìN MISI√ìN Y VISI√ìN -->
<section style="background: linear-gradient(135deg, var(--brand-blue) 0%, var(--brand-green) 100%); padding: 80px 0; position: relative; overflow: hidden;">
    <!-- Patr√≥n de fondo decorativo -->
    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.1; background-image: radial-gradient(circle at 20% 50%, rgba(255,255,255,0.3) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(255,255,255,0.2) 0%, transparent 50%);"></div>
    
    <div class="container-modern" style="position: relative; z-index: 1;">
        <div class="row justify-content-center">
            <div class="col-lg-10 text-center mb-5">
                <div style="display: inline-block; background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 12px 24px; border-radius: 50px; margin-bottom: 24px; border: 1px solid rgba(255,255,255,0.2);">
                    <i class="fas fa-heart" style="color: #FFFFFF; margin-right: 8px;"></i>
                    <span style="color: #FFFFFF; font-weight: 600; font-size: 0.9375rem; letter-spacing: 0.5px;">Nuestra Historia</span>
                </div>
                <h2 style="color: #FFFFFF; font-weight: 800; font-size: 2.5rem; margin-bottom: 24px; letter-spacing: -0.02em; text-shadow: 0 2px 20px rgba(0,0,0,0.2);">
                    ¬øPor qu√© naci√≥ Ubik2CR?
                </h2>
            </div>
        </div>
        
        <div class="row g-4 justify-content-center">
            <!-- Misi√≥n -->
            <div class="col-lg-5 col-md-6">
                <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); border-radius: var(--radius-xl); padding: 40px; height: 100%; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 8px 32px rgba(0,0,0,0.2); transition: transform var(--transition-base);">
                    <div style="width: 64px; height: 64px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 24px; border: 2px solid rgba(255,255,255,0.3);">
                        <i class="fas fa-bullseye" style="font-size: 1.75rem; color: #FFFFFF;"></i>
                    </div>
                    <h3 style="color: #FFFFFF; font-weight: 700; font-size: 1.5rem; margin-bottom: 16px; letter-spacing: -0.02em;">
                        Nuestra Misi√≥n
                    </h3>
                    <p style="color: rgba(255,255,255,0.9); font-size: 1rem; line-height: 1.8; margin: 0;">
                        Conectar a cada comunidad costarricense con los mejores negocios, servicios y lugares de su zona. Queremos que descubras todo lo que tu cant√≥n tiene para ofrecer, desde el restaurante familiar hasta el servicio que necesitas, todo en un solo lugar.
                    </p>
                </div>
            </div>
            
            <!-- Visi√≥n -->
            <div class="col-lg-5 col-md-6">
                <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); border-radius: var(--radius-xl); padding: 40px; height: 100%; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 8px 32px rgba(0,0,0,0.2); transition: transform var(--transition-base);">
                    <div style="width: 64px; height: 64px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 24px; border: 2px solid rgba(255,255,255,0.3);">
                        <i class="fas fa-eye" style="font-size: 1.75rem; color: #FFFFFF;"></i>
                    </div>
                    <h3 style="color: #FFFFFF; font-weight: 700; font-size: 1.5rem; margin-bottom: 16px; letter-spacing: -0.02em;">
                        Nuestra Visi√≥n
                    </h3>
                    <p style="color: rgba(255,255,255,0.9); font-size: 1rem; line-height: 1.8; margin: 0;">
                        Ser la plataforma de referencia para que los costarricenses descubran y apoyen los negocios locales de su comunidad. Creemos en fortalecer la econom√≠a local y en hacer que cada cant√≥n sea m√°s accesible y conectado.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Valores -->
        <div class="row mt-5">
            <div class="col-12">
                <div style="background: rgba(255,255,255,0.08); backdrop-filter: blur(10px); border-radius: var(--radius-lg); padding: 32px; border: 1px solid rgba(255,255,255,0.15);">
                    <h4 style="color: #FFFFFF; font-weight: 700; font-size: 1.25rem; margin-bottom: 20px; text-align: center; letter-spacing: -0.02em;">
                        <i class="fas fa-star" style="margin-right: 8px; color: #FFD700;"></i>
                        Nuestros Valores
                    </h4>
                    <div class="row g-3 text-center">
                        <div class="col-md-3 col-6">
                            <div style="color: rgba(255,255,255,0.9); font-weight: 600; font-size: 0.9375rem;">
                                <i class="fas fa-handshake" style="display: block; font-size: 1.5rem; margin-bottom: 8px; color: #FFFFFF;"></i>
                                Comunidad
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div style="color: rgba(255,255,255,0.9); font-weight: 600; font-size: 0.9375rem;">
                                <i class="fas fa-shield-alt" style="display: block; font-size: 1.5rem; margin-bottom: 8px; color: #FFFFFF;"></i>
                                Confianza
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div style="color: rgba(255,255,255,0.9); font-weight: 600; font-size: 0.9375rem;">
                                <i class="fas fa-lightbulb" style="display: block; font-size: 1.5rem; margin-bottom: 8px; color: #FFFFFF;"></i>
                                Innovaci√≥n
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div style="color: rgba(255,255,255,0.9); font-weight: 600; font-size: 0.9375rem;">
                                <i class="fas fa-heart" style="display: block; font-size: 1.5rem; margin-bottom: 8px; color: #FFFFFF;"></i>
                                Compromiso
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FOOTER PREMIUM -->
<footer>
    <!-- Patr√≥n de fondo sutil -->
    <div class="footer-pattern-bg"></div>
    
    <div class="container-modern" style="position: relative; z-index: 1;">
        <div class="row g-5 mb-5">
            <!-- Informaci√≥n Principal -->
            <div class="col-lg-6 mb-4">
                <div class="mb-4">
                    <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR" style="height: 80px; width: auto; margin-bottom: 16px; filter: brightness(0) invert(1);">
                    <h5 style="color: #FFFFFF; font-weight: 700; margin-bottom: 16px; font-size: 1.25rem; letter-spacing: -0.02em;">Ubik2CR</h5>
                </div>
                <p style="color: rgba(255,255,255,0.75); font-size: 0.9375rem; line-height: 1.8; margin-bottom: 32px; max-width: 90%;">
                    Tu cant√≥n en tu mano. Conectamos a tu comunidad con los mejores negocios, servicios y lugares de tu zona.
                </p>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <a href="/mapa" class="footer-link">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Mapa</span>
                    </a>
                    <a href="/noticias" class="footer-link">
                        <i class="fas fa-newspaper"></i>
                        <span>Noticias</span>
                    </a>
                    <a href="/cuenta" class="footer-link">
                        <i class="fas fa-user"></i>
                        <span>Cuenta</span>
                    </a>
                </div>
            </div>
            
            <!-- Cr√©ditos de Desarrollo - Tico-App -->
            <div class="col-lg-6 mb-4">
                <h5 style="color: #FFFFFF; font-weight: 700; margin-bottom: 20px; font-size: 1.125rem; letter-spacing: -0.02em;">
                    <i class="fas fa-code me-2" style="color: var(--primary);"></i>Desarrollado por
                </h5>
                <div style="background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border-radius: var(--radius-lg); padding: 28px; border: 1px solid rgba(255,255,255,0.1); transition: all var(--transition-base); box-shadow: var(--shadow-md);">
                    <a href="https://tico-app.com/" target="_blank" rel="noopener noreferrer" class="footer-brand-link" style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                        <div class="footer-brand-icon">
                            <i class="fas fa-code" style="font-size: 1.25rem; color: #FFFFFF;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="color: #FFFFFF; font-weight: 700; font-size: 1.25rem; margin-bottom: 4px; letter-spacing: -0.02em;">Tico-App</div>
                            <div style="color: rgba(255,255,255,0.7); font-size: 0.875rem; font-weight: 500;">Desarrollo de Aplicaciones</div>
                        </div>
                        <i class="fas fa-external-link-alt" style="font-size: 0.875rem; opacity: 0.5; transition: opacity var(--transition-fast);"></i>
                    </a>
                    <p style="color: rgba(255,255,255,0.65); font-size: 0.875rem; margin: 0; line-height: 1.7; display: flex; align-items: flex-start; gap: 10px;">
                        <i class="fas fa-sparkles" style="color: var(--primary); font-size: 1rem; margin-top: 2px; flex-shrink: 0;"></i>
                        <span>Aplicaciones que transforman tu d√≠a a d√≠a. Desarrollamos apps para facilitar tu vida y tu negocio con tecnolog√≠a avanzada y accesible.</span>
                    </p>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <a href="https://tico-app.com/" target="_blank" rel="noopener noreferrer" 
                           class="footer-link" style="font-weight: 600;">
                            <i class="fas fa-globe"></i>
                            <span>Visitar tico-app.com</span>
                            <i class="fas fa-arrow-right" style="margin-left: 4px; font-size: 0.75rem;"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- L√≠nea Divisoria -->
        <div style="height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent); margin: 48px 0 32px;"></div>
        
        <!-- Copyright y Links Legales -->
        <div class="row align-items-center">
            <div class="col-md-6 mb-3 mb-md-0">
                <p style="margin: 0; color: rgba(255,255,255,0.6); font-size: 0.875rem; display: flex; align-items: center; gap: 8px;">
                    <i class="far fa-copyright" style="font-size: 0.75rem;"></i>
                    <span>2025 Ubik2CR. Todos los derechos reservados.</span>
                </p>
            </div>
            <div class="col-md-6 text-md-end">
                <a href="https://tico-app.com/" target="_blank" rel="noopener noreferrer" 
                   class="footer-link" style="font-weight: 500;">
                    <i class="fas fa-code"></i>
                    <span>Creado con</span>
                    <span style="color: var(--primary); font-weight: 700;">Tico-App</span>
                </a>
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script para compartir y descargar noticias/ofertas -->
    <script>
        // Funci√≥n para obtener la URL base
        function getBaseUrl() {
            return window.location.origin;
        }

        // Compartir noticia
        function compartirNoticia(noticiaId, titulo) {
            const url = `${getBaseUrl()}/noticias`;
            const texto = `üì∞ ${titulo}\n\nDescubre esta y m√°s noticias en Ubik2CR:\n${url}`;
            
            // Intentar usar Web Share API (dispositivos m√≥viles)
            if (navigator.share) {
                navigator.share({
                    title: titulo,
                    text: texto,
                    url: url
                }).catch(err => {
                    console.log('Error al compartir:', err);
                    fallbackCompartir(texto, url);
                });
            } else {
                fallbackCompartir(texto, url);
            }
        }

        // Compartir oferta
        function compartirOferta(ofertaId, negocioId, titulo) {
            const url = `${getBaseUrl()}/negocio/${negocioId}`;
            const texto = `üéØ ${titulo}\n\n¬°Mira esta oferta en Ubik2CR!\n${url}`;
            
            // Intentar usar Web Share API (dispositivos m√≥viles)
            if (navigator.share) {
                navigator.share({
                    title: titulo,
                    text: texto,
                    url: url
                }).catch(err => {
                    console.log('Error al compartir:', err);
                    fallbackCompartir(texto, url);
                });
            } else {
                fallbackCompartir(texto, url);
            }
        }

        // Funci√≥n auxiliar para compartir (fallback)
        function fallbackCompartir(texto, url) {
            // Copiar al portapapeles
            if (navigator.clipboard) {
                navigator.clipboard.writeText(texto + '\n' + url).then(() => {
                    alert('¬°Enlace copiado al portapapeles! Ahora puedes compartirlo.');
                }).catch(() => {
                    mostrarModalCompartir(texto, url);
                });
            } else {
                mostrarModalCompartir(texto, url);
            }
        }

        // Modal para compartir
        function mostrarModalCompartir(texto, url) {
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(texto + '\n' + url)}`;
            const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(texto)}&url=${encodeURIComponent(url)}`;
            
            const modal = `
                <div class="modal fade" id="modalCompartir" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Compartir</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="d-grid gap-2">
                                    <a href="${whatsappUrl}" target="_blank" class="btn btn-success">
                                        <i class="fab fa-whatsapp me-2"></i> WhatsApp
                                    </a>
                                    <a href="${facebookUrl}" target="_blank" class="btn btn-primary">
                                        <i class="fab fa-facebook me-2"></i> Facebook
                                    </a>
                                    <a href="${twitterUrl}" target="_blank" class="btn btn-info text-white">
                                        <i class="fab fa-twitter me-2"></i> Twitter
                                    </a>
                                    <button class="btn btn-outline-secondary" onclick="copiarEnlace('${url}')">
                                        <i class="fas fa-copy me-2"></i> Copiar Enlace
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal anterior si existe
            const modalExistente = document.getElementById('modalCompartir');
            if (modalExistente) {
                modalExistente.remove();
            }
            
            // Agregar modal al body
            document.body.insertAdjacentHTML('beforeend', modal);
            const modalElement = new bootstrap.Modal(document.getElementById('modalCompartir'));
            modalElement.show();
            
            // Remover modal del DOM despu√©s de cerrarse
            document.getElementById('modalCompartir').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }

        // Copiar enlace al portapapeles
        function copiarEnlace(url) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(url).then(() => {
                    alert('¬°Enlace copiado al portapapeles!');
                });
            } else {
                // Fallback para navegadores antiguos
                const textarea = document.createElement('textarea');
                textarea.value = url;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('¬°Enlace copiado al portapapeles!');
            }
        }

        // Descargar noticia como imagen
        async function descargarNoticia(noticiaId) {
            try {
                // Buscar el carousel item activo de noticias
                const carousel = document.querySelector('#noticiasCarousel .carousel-item.active');
                if (!carousel) {
                    alert('No se pudo encontrar la noticia para descargar.');
                    return;
                }
                
                // Crear un elemento temporal con mejor formato para la imagen
                const tempDiv = document.createElement('div');
                tempDiv.style.width = '800px';
                tempDiv.style.padding = '30px';
                tempDiv.style.background = 'white';
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                
                const cloned = carousel.cloneNode(true);
                cloned.style.width = '800px';
                cloned.style.height = 'auto';
                cloned.style.position = 'relative';
                cloned.style.display = 'block';
                
                tempDiv.appendChild(cloned);
                document.body.appendChild(tempDiv);
                
                // Usar html2canvas para convertir a imagen
                const canvas = await html2canvas(tempDiv, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false
                });
                
                // Descargar la imagen
                const link = document.createElement('a');
                link.download = `noticia-ubik2cr-${noticiaId}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // Limpiar
                document.body.removeChild(tempDiv);
            } catch (error) {
                console.error('Error al descargar noticia:', error);
                alert('No se pudo descargar la imagen. Por favor, intenta hacer una captura de pantalla.');
            }
        }

        // Descargar oferta como imagen
        async function descargarOferta(ofertaId) {
            try {
                // Buscar el carousel item activo de ofertas
                const carousel = document.querySelector('#ofertasCarousel .carousel-item.active');
                if (!carousel) {
                    alert('No se pudo encontrar la oferta para descargar.');
                    return;
                }
                
                // Crear un elemento temporal con mejor formato para la imagen
                const tempDiv = document.createElement('div');
                tempDiv.style.width = '800px';
                tempDiv.style.padding = '30px';
                tempDiv.style.background = 'white';
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                
                const cloned = carousel.cloneNode(true);
                cloned.style.width = '800px';
                cloned.style.height = 'auto';
                cloned.style.position = 'relative';
                cloned.style.display = 'block';
                
                tempDiv.appendChild(cloned);
                document.body.appendChild(tempDiv);
                
                // Usar html2canvas para convertir a imagen
                const canvas = await html2canvas(tempDiv, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false
                });
                
                // Descargar la imagen
                const link = document.createElement('a');
                link.download = `oferta-ubik2cr-${ofertaId}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // Limpiar
                document.body.removeChild(tempDiv);
            } catch (error) {
                console.error('Error al descargar oferta:', error);
                alert('No se pudo descargar la imagen. Por favor, intenta hacer una captura de pantalla.');
            }
        }
    </script>
    
    <!-- Script para mejorar experiencia m√≥vil -->
    <script>
        // Prevenir zoom doble-tap en botones (iOS)
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // Mejorar feedback t√°ctil en botones
        document.querySelectorAll('button, .btn, a.btn').forEach(btn => {
            btn.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.98)';
                this.style.opacity = '0.9';
            }, { passive: true });
            
            btn.addEventListener('touchend', function() {
                setTimeout(() => {
                    this.style.transform = '';
                    this.style.opacity = '';
                }, 150);
            }, { passive: true });
        });
        
        // Asegurar que los modales funcionen en m√≥vil
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar tooltips y popovers si existen
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Asegurar que el navbar collapse funcione correctamente
            var navbarToggler = document.querySelector('.navbar-toggler');
            var navbarCollapse = document.querySelector('.navbar-collapse');
            
            if (navbarToggler && navbarCollapse) {
                navbarToggler.addEventListener('click', function() {
                    navbarCollapse.classList.toggle('show');
                    var isExpanded = navbarToggler.getAttribute('aria-expanded') === 'true';
                    navbarToggler.setAttribute('aria-expanded', !isExpanded);
                });
                
                // Cerrar el men√∫ al hacer click en un enlace (solo en m√≥vil)
                if (window.innerWidth < 992) {
                    navbarCollapse.querySelectorAll('.nav-link-premium, .btn-modern').forEach(function(link) {
                        link.addEventListener('click', function() {
                            navbarCollapse.classList.remove('show');
                            navbarToggler.setAttribute('aria-expanded', 'false');
                        });
                    });
                }
            }
        });
    </script>
</body>
</html>

