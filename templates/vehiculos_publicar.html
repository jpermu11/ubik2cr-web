<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publicar Vehículo | Ubik2CR</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        :root {
            --brand-blue: #19539D;
            --brand-green: #69D41B;
        }
        
        body {
            background: linear-gradient(180deg, rgba(25, 83, 157, 0.03), rgba(105, 212, 27, 0.03));
            min-height: 100vh;
        }
        
        .form-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 40px;
            margin: 30px 0;
        }
        
        .form-section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid var(--gray-200);
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            color: var(--brand-blue);
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-label {
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-label.required::after {
            content: " *";
            color: #dc3545;
        }
        
        .form-help {
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-top: 5px;
            padding: 8px 12px;
            background: var(--gray-100);
            border-radius: 8px;
            border-left: 3px solid var(--brand-green);
        }
        
        .form-control, .form-select {
            border: 2px solid var(--gray-300);
            border-radius: 10px;
            padding: 12px 15px;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--brand-blue);
            box-shadow: 0 0 0 3px rgba(25, 83, 157, 0.1);
            outline: none;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, var(--brand-blue), var(--brand-green));
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            transition: all 0.3s;
            width: 100%;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(25, 83, 157, 0.3);
            color: white;
        }
        
        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .image-preview {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 1;
            border: 2px solid var(--gray-300);
        }
        
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-preview .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .price-input-group {
            position: relative;
        }
        
        .price-input-group::before {
            content: "₡";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
            font-weight: 700;
            z-index: 10;
        }
        
        .price-input-group input {
            padding-left: 35px;
        }
        
        .hero-publish {
            background: linear-gradient(135deg, var(--brand-blue) 0%, var(--brand-green) 100%);
            padding: 40px 0;
            color: white;
            text-align: center;
        }
        
        .hero-publish h1 {
            font-weight: 800;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .hero-publish p {
            font-size: 1.1rem;
            opacity: 0.95;
        }
    </style>
</head>
<body>

<!-- HEADER -->
<nav class="navbar-premium navbar-expand-lg" style="background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div class="container-modern">
        <a class="navbar-brand-premium" href="/" style="font-weight: 800; font-size: 1.5rem;">
            <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR" style="height: 60px; width: auto; object-fit: contain;">
            <span class="d-none d-sm-inline" style="background: linear-gradient(135deg, var(--brand-blue), var(--brand-green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">UBIK2CR</span>
        </a>
        <div class="d-flex gap-2">
            <a href="/" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Volver
            </a>
        </div>
    </div>
</nav>

<!-- HERO -->
<section class="hero-publish">
    <div class="container">
        <h1><i class="fas fa-car me-2"></i>Publicar tu Vehículo</h1>
        <p>Completá el formulario y llegá a miles de compradores en Costa Rica</p>
    </div>
</section>

<!-- FORMULARIO -->
<div class="container">
    <div class="form-container">
        <form method="POST" enctype="multipart/form-data" id="formVehiculo">
            
            <!-- INFORMACIÓN BÁSICA -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-info-circle"></i>
                    Información Básica
                </h3>
                
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label required">
                            <i class="fas fa-tag"></i>Marca
                        </label>
                        <input type="text" name="marca" class="form-control" required 
                               placeholder="Ej: Toyota, Honda, Nissan..." 
                               list="marcas-list">
                        <datalist id="marcas-list">
                            <option value="Toyota">
                            <option value="Honda">
                            <option value="Nissan">
                            <option value="Hyundai">
                            <option value="Kia">
                            <option value="Mazda">
                            <option value="Suzuki">
                            <option value="Mitsubishi">
                            <option value="Ford">
                            <option value="Chevrolet">
                            <option value="Volkswagen">
                            <option value="BMW">
                            <option value="Mercedes-Benz">
                            <option value="Audi">
                            <option value="Volvo">
                        </datalist>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Ingresá la marca del vehículo. Podés escribir libremente o seleccionar de la lista.
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label required">
                            <i class="fas fa-car-side"></i>Modelo
                        </label>
                        <input type="text" name="modelo" class="form-control" required 
                               placeholder="Ej: Corolla, Civic, Sentra...">
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            El modelo específico del vehículo (ej: Corolla, Civic, CR-V, etc.)
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label required">
                            <i class="fas fa-calendar"></i>Año
                        </label>
                        <input type="number" name="año" class="form-control" required 
                               min="1950" max="2025" placeholder="Ej: 2020">
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Año de fabricación del vehículo (entre 1950 y 2025)
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PRECIO Y CARACTERÍSTICAS -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-dollar-sign"></i>
                    Precio y Características
                </h3>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label required">
                            <i class="fas fa-money-bill-wave"></i>Precio (Colones)
                        </label>
                        <div class="price-input-group">
                            <input type="number" name="precio" class="form-control" required 
                                   min="0" step="1000" placeholder="Ej: 5000000">
                        </div>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Precio de venta en colones costarricenses. Podés usar números sin puntos ni comas.
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">
                            <i class="fas fa-tachometer-alt"></i>Kilometraje
                        </label>
                        <input type="number" name="kilometraje" class="form-control" 
                               min="0" placeholder="Ej: 50000">
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Kilómetros recorridos. Si el vehículo es nuevo, dejá este campo vacío.
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label required">
                            <i class="fas fa-car"></i>Tipo de Vehículo
                        </label>
                        <select name="tipo_vehiculo" class="form-select" required>
                            <option value="">Seleccioná un tipo</option>
                            <option value="Sedán">Sedán</option>
                            <option value="SUV">SUV</option>
                            <option value="Pickup">Pickup</option>
                            <option value="Hatchback">Hatchback</option>
                            <option value="Moto">Moto</option>
                            <option value="Camioneta">Camioneta</option>
                            <option value="Van">Van</option>
                            <option value="Otro">Otro</option>
                        </select>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Categoría principal del vehículo
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-cog"></i>Transmisión
                        </label>
                        <select name="transmision" class="form-select">
                            <option value="">Seleccioná</option>
                            <option value="Manual">Manual</option>
                            <option value="Automática">Automática</option>
                        </select>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Tipo de transmisión del vehículo
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-gas-pump"></i>Combustible
                        </label>
                        <select name="combustible" class="form-select">
                            <option value="">Seleccioná</option>
                            <option value="Gasolina">Gasolina</option>
                            <option value="Diésel">Diésel</option>
                            <option value="Eléctrico">Eléctrico</option>
                            <option value="Híbrido">Híbrido</option>
                        </select>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Tipo de combustible o energía que utiliza
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">
                            <i class="fas fa-palette"></i>Color
                        </label>
                        <input type="text" name="color" class="form-control" 
                               placeholder="Ej: Blanco, Negro, Plata...">
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Color principal del vehículo
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">
                            <i class="fas fa-check-circle"></i>Estado del Vehículo
                        </label>
                        <select name="estado_vehiculo" class="form-select">
                            <option value="Usado">Usado</option>
                            <option value="Nuevo">Nuevo</option>
                            <option value="Seminuevo">Seminuevo</option>
                        </select>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Condición general del vehículo
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- DESCRIPCIÓN -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-align-left"></i>
                    Descripción
                </h3>
                
                <div class="row">
                    <div class="col-12">
                        <label class="form-label required">
                            <i class="fas fa-file-alt"></i>Descripción Detallada
                        </label>
                        <textarea name="descripcion" class="form-control" rows="6" required 
                                  placeholder="Describí tu vehículo: estado general, características especiales, accesorios incluidos, historial de mantenimiento, etc."></textarea>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>Consejos:</strong> Mencioná el estado general, accesorios incluidos, historial de mantenimiento, 
                            si tiene factura, si está al día con el marchamo, y cualquier detalle que pueda interesar a los compradores.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- UBICACIÓN -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Ubicación
                </h3>
                
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-map"></i>Provincia
                        </label>
                        <select name="provincia" class="form-select" id="provinciaSelect" onchange="cargarCantones()">
                            <option value="">Seleccioná una provincia</option>
                            {% for provincia in ubicaciones_data.keys() %}
                            <option value="{{ provincia }}">{{ provincia }}</option>
                            {% endfor %}
                        </select>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Provincia donde se encuentra el vehículo
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-map"></i>Cantón
                        </label>
                        <select name="canton" class="form-select" id="cantonSelect" disabled onchange="cargarDistritos()">
                            <option value="">Primero seleccioná una provincia</option>
                        </select>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Cantón donde se encuentra el vehículo
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-map"></i>Distrito
                        </label>
                        <select name="distrito" class="form-select" id="distritoSelect" disabled>
                            <option value="">Primero seleccioná un cantón</option>
                        </select>
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Distrito donde se encuentra el vehículo (opcional)
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CONTACTO -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-phone"></i>
                    Información de Contacto
                </h3>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">
                            <i class="fas fa-phone"></i>Teléfono
                        </label>
                        <input type="tel" name="telefono" class="form-control" 
                               placeholder="Ej: 2448-5858 o +506 8888-8888">
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Número de teléfono para contacto (opcional)
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">
                            <i class="fab fa-whatsapp"></i>WhatsApp
                        </label>
                        <input type="tel" name="whatsapp" class="form-control" 
                               placeholder="Ej: +506 8888-8888">
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Número de WhatsApp con código de país (ej: +506 8888-8888). 
                            Los compradores podrán contactarte directamente.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- IMÁGENES -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-images"></i>
                    Imágenes del Vehículo
                </h3>
                
                <div class="row">
                    <div class="col-12">
                        <label class="form-label required">
                            <i class="fas fa-camera"></i>Subir Imágenes
                        </label>
                        <input type="file" name="imagenes" class="form-control" 
                               accept="image/*" multiple required id="imagenesInput" onchange="previewImages(this)">
                        <div class="form-help">
                            <i class="fas fa-lightbulb me-2"></i>
                            Podés subir hasta 10 imágenes. La primera será la imagen principal. 
                            Formatos: JPG, PNG. Tamaño máximo: 5MB por imagen.
                        </div>
                        
                        <div class="image-preview-container" id="previewContainer"></div>
                    </div>
                </div>
            </div>
            
            <!-- BOTÓN SUBMIT -->
            <div class="row mt-4">
                <div class="col-12">
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-paper-plane me-2"></i>
                        Publicar Vehículo
                    </button>
                    <div class="form-help mt-3 text-center">
                        <i class="fas fa-info-circle me-2"></i>
                        Tu publicación quedará <strong>pendiente de aprobación</strong>. 
                        Te notificaremos cuando esté publicada.
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- FOOTER -->
<footer class="bg-dark text-white py-4 mt-5">
    <div class="container text-center">
        <p class="mb-0">&copy; 2024 Ubik2CR. Todos los derechos reservados.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const ubicacionesData = {{ ubicaciones_data | tojson }};

function cargarCantones() {
    const provinciaSelect = document.getElementById('provinciaSelect');
    const cantonSelect = document.getElementById('cantonSelect');
    const distritoSelect = document.getElementById('distritoSelect');
    const provincia = provinciaSelect.value;
    
    cantonSelect.innerHTML = '<option value="">Seleccioná un cantón</option>';
    distritoSelect.innerHTML = '<option value="">Primero seleccioná un cantón</option>';
    distritoSelect.disabled = true;
    
    if (provincia && ubicacionesData[provincia]) {
        const cantones = Object.keys(ubicacionesData[provincia]);
        cantones.forEach(canton => {
            const option = document.createElement('option');
            option.value = canton;
            option.textContent = canton;
            cantonSelect.appendChild(option);
        });
        cantonSelect.disabled = false;
    } else {
        cantonSelect.disabled = true;
    }
}

function cargarDistritos() {
    const provinciaSelect = document.getElementById('provinciaSelect');
    const cantonSelect = document.getElementById('cantonSelect');
    const distritoSelect = document.getElementById('distritoSelect');
    const provincia = provinciaSelect.value;
    const canton = cantonSelect.value;
    
    distritoSelect.innerHTML = '<option value="">Seleccioná un distrito</option>';
    
    if (provincia && canton && ubicacionesData[provincia] && ubicacionesData[provincia][canton]) {
        const distritos = ubicacionesData[provincia][canton];
        distritos.forEach(distrito => {
            const option = document.createElement('option');
            option.value = distrito;
            option.textContent = distrito;
            distritoSelect.appendChild(option);
        });
        distritoSelect.disabled = false;
    } else {
        distritoSelect.disabled = true;
    }
}

function previewImages(input) {
    const container = document.getElementById('previewContainer');
    container.innerHTML = '';
    
    if (input.files && input.files.length > 0) {
        const maxImages = 10;
        const filesToShow = Array.from(input.files).slice(0, maxImages);
        
        filesToShow.forEach((file, index) => {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'image-preview';
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="Preview ${index + 1}">
                        <button type="button" class="remove-btn" onclick="removeImage(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
        });
        
        if (input.files.length > maxImages) {
            alert(`Solo se pueden subir hasta ${maxImages} imágenes. Se mostrarán las primeras ${maxImages}.`);
        }
    }
}

function removeImage(index) {
    // Esta función se puede mejorar para eliminar realmente el archivo del input
    const container = document.getElementById('previewContainer');
    const previews = container.querySelectorAll('.image-preview');
    if (previews[index]) {
        previews[index].remove();
    }
}

// Validación del formulario
document.getElementById('formVehiculo').addEventListener('submit', function(e) {
    const precio = document.querySelector('input[name="precio"]').value;
    if (precio && parseFloat(precio) < 0) {
        e.preventDefault();
        alert('El precio no puede ser negativo');
        return false;
    }
    
    const año = document.querySelector('input[name="año"]').value;
    if (año && (parseInt(año) < 1950 || parseInt(año) > 2025)) {
        e.preventDefault();
        alert('El año debe estar entre 1950 y 2025');
        return false;
    }
    
    const imagenes = document.getElementById('imagenesInput').files;
    if (!imagenes || imagenes.length === 0) {
        e.preventDefault();
        alert('Debés subir al menos una imagen del vehículo');
        return false;
    }
    
    if (imagenes.length > 10) {
        e.preventDefault();
        alert('Solo se pueden subir hasta 10 imágenes');
        return false;
    }
});
</script>
</body>
</html>
