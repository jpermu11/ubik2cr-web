<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Publicar Negocio | Ubik2CR</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Leaflet (mapa con pin) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body { background:#f5f7fa; }

    .topbar{
      background: linear-gradient(90deg,#0b4fa3,#38b24d);
      color:#fff;
    }
    .brand img{ height:56px; }
    .brand span{ font-weight:800; letter-spacing:.2px; }

    .hero-mini{
      background: linear-gradient(135deg, rgba(11,79,163,.12), rgba(56,178,77,.12));
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 18px;
      padding: 18px;
    }

    .cardx{
      border:none; border-radius:18px;
      box-shadow:0 10px 25px rgba(0,0,0,.08);
      overflow:hidden;
    }
    .cardx-header{
      background: rgba(11,79,163,.08);
      border-bottom:1px solid rgba(0,0,0,.06);
    }

    #map{
      height: 360px;
      border-radius: 14px;
      border:1px solid rgba(0,0,0,.10);
    }

    .hint{
      font-size:.92rem;
      color:#6c757d;
    }

    .btn-primary{
      background:#0b4fa3;
      border:none;
      font-weight:800;
    }
    .btn-primary:hover{ filter:brightness(.95); }

    .btn-success{
      background:#38b24d;
      border:none;
      font-weight:800;
    }
    .btn-success:hover{ filter:brightness(.95); }

    .required::after{
      content:" *";
      color:#dc3545;
      font-weight:800;
    }
  </style>
</head>

<body>

<!-- HEADER -->
<nav class="navbar topbar">
  <div class="container d-flex align-items-center justify-content-between py-2">
    <a class="navbar-brand brand d-flex align-items-center gap-2 text-white text-decoration-none" href="/">
      <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR">
      <span class="fs-4">Ubik2CR</span>
    </a>

    <div class="d-flex gap-2">
      <a href="/" class="btn btn-light fw-bold">
        <i class="fa-solid fa-house me-1"></i> Inicio
      </a>
      <a href="/mapa" class="btn btn-outline-light">
        <i class="fa-solid fa-map-location-dot me-1"></i> Mapa
      </a>
    </div>
  </div>
</nav>

<div class="container my-4">

  <div class="hero-mini mb-3 d-flex align-items-center justify-content-between flex-wrap gap-2">
    <div>
      <h2 class="fw-bold mb-1">ğŸ“Œ Publicar un Negocio o Lugar</h2>
      <div class="hint">
        No necesitÃ¡s saber coordenadas: <b>tocÃ¡ el mapa</b> y el pin se coloca solo âœ…
      </div>
    </div>
    <img src="{{ url_for('static', filename='uploads/logo.png') }}" alt="Ubik2CR" style="height:70px;">
  </div>

  <div class="cardx">
    <div class="cardx-header p-3">
      <div class="fw-bold">
        <i class="fa-solid fa-circle-plus me-2"></i> Formulario de publicaciÃ³n
      </div>
      <div class="hint">Tu negocio queda <b>pendiente</b> hasta ser aprobado por el administrador.</div>
    </div>

    <div class="p-4">
      <form method="POST" enctype="multipart/form-data">

        <div class="row g-3">

          <div class="col-md-8">
            <label class="form-label fw-bold required">Nombre del negocio / lugar</label>
            <input type="text" name="nombre" class="form-control form-control-lg" required placeholder="Ej: Soda Don Pepe, Iglesia San Pedro...">
          </div>

          <div class="col-md-4">
            <label class="form-label fw-bold required">CategorÃ­a</label>
            <select name="categoria" class="form-select form-select-lg" required>
              
              <optgroup label="ğŸ½ï¸ Comida y Bebidas">
                <option value="Sodas y Rest.">ğŸ´ Sodas y Rest.</option>
                <option value="Comida RÃ¡pida">ğŸ• Comida RÃ¡pida</option>
                <option value="CafeterÃ­as">â˜• CafeterÃ­as</option>
                <option value="Bares y Licores">ğŸº Bares y Licores</option>
                <option value="HeladerÃ­as">ğŸ¦ HeladerÃ­as</option>
                <option value="Restaurante">ğŸ” Restaurantes</option>
              </optgroup>
              
              <optgroup label="ğŸ›’ Alimentos">
                <option value="VerdurerÃ­as">ğŸ¥¬ VerdurerÃ­as</option>
                <option value="CarnicerÃ­as">ğŸ¥© CarnicerÃ­as</option>
                <option value="PanaderÃ­as">ğŸ¥ PanaderÃ­as</option>
                <option value="Super y Pulpes">ğŸ›’ Super y Pulpes</option>
              </optgroup>
              
              <optgroup label="ğŸ¥ Salud">
                <option value="Farmacias">ğŸ’Š Farmacias</option>
                <option value="ClÃ­nicas y Dr.">ğŸ©º ClÃ­nicas y Dr.</option>
                <option value="Dentistas">ğŸ¦· Dentistas</option>
                <option value="Laboratorios">ğŸ§ª Laboratorios</option>
                <option value="Veterinarias">ğŸ¾ Veterinarias</option>
                <option value="Ã“pticas">ğŸ‘“ Ã“pticas</option>
                <option value="CCSS">ğŸ¥ CCSS / ClÃ­nica / EbÃ¡is</option>
              </optgroup>
              
              <optgroup label="ğŸ’… Belleza y Fitness">
                <option value="Gimnasios">ğŸ’ª Gimnasios</option>
                <option value="Spas y Masajes">ğŸ§˜ Spas y Masajes</option>
                <option value="Belleza y BarberÃ­a">âœ‚ï¸ Belleza y BarberÃ­a</option>
              </optgroup>
              
              <optgroup label="ğŸ‘• Ropa y TecnologÃ­a">
                <option value="Ropa y Calzado">ğŸ‘— Ropa y Calzado</option>
                <option value="TecnologÃ­a y Cel.">ğŸ“± TecnologÃ­a y Cel.</option>
                <option value="Reparaciones Tech">ğŸ’» Reparaciones Tech</option>
              </optgroup>
              
              <optgroup label="ğŸ”§ ConstrucciÃ³n y Automotriz">
                <option value="FerreterÃ­as">ğŸ”¨ FerreterÃ­as</option>
                <option value="Materiales ConstrucciÃ³n">ğŸ§± Materiales ConstrucciÃ³n</option>
                <option value="MecÃ¡nica y Llantas">ğŸ”§ MecÃ¡nica y Llantas</option>
                <option value="Transporte">ğŸš• Transporte</option>
                <option value="Gasolineras">â›½ Gasolineras</option>
                <option value="Automotriz">ğŸš— Automotriz</option>
              </optgroup>
              
              <optgroup label="ğŸ“š EducaciÃ³n y Cultura">
                <option value="LibrerÃ­as y Bazar">ğŸ“– LibrerÃ­as y Bazar</option>
                <option value="Escuelas">ğŸ« Escuelas</option>
                <option value="Bibliotecas">ğŸ“š Bibliotecas</option>
                <option value="Academias">ğŸ“ Academias</option>
                <option value="Educacion">ğŸ“ EducaciÃ³n</option>
              </optgroup>
              
              <optgroup label="ğŸ¨ Turismo y Entretenimiento">
                <option value="Hoteles y Hospedaje">ğŸ¨ Hoteles y Hospedaje</option>
                <option value="Parques">ğŸŒ³ Parques</option>
                <option value="Plazas">ğŸï¸ Plazas</option>
                <option value="Polideportivo">ğŸŸï¸ Polideportivos</option>
                <option value="Cines y Entretenimiento">ğŸ¬ Cines y Entretenimiento</option>
                <option value="Turismo">ğŸ—ºï¸ Turismo</option>
              </optgroup>
              
              <optgroup label="ğŸ’° Finanzas">
                <option value="Bancos">ğŸ¦ Bancos</option>
                <option value="Cooperativas">ğŸ’µ Cooperativas</option>
              </optgroup>
              
              <optgroup label="ğŸ›ï¸ Servicios PÃºblicos">
                <option value="Cruz Roja">ğŸš‘ Cruz Roja</option>
                <option value="Bomberos">ğŸš’ Bomberos</option>
                <option value="PolicÃ­a">ğŸš“ PolicÃ­a</option>
                <option value="Municipalidad">ğŸ›ï¸ Municipalidad</option>
                <option value="Iglesia">â›ª Iglesias</option>
                <option value="Instituciones PÃºblicas">ğŸ¢ Instituciones PÃºblicas</option>
                <option value="Edificio Gubernamental">ğŸ¢ Edificio Gubernamental</option>
              </optgroup>
              
              <optgroup label="ğŸ’¼ Servicios Profesionales">
                <option value="Servicios Pro">ğŸ’¼ Servicios Pro</option>
                <option value="ConsultorÃ­a">ğŸ“Š ConsultorÃ­a</option>
                <option value="Abogados">âš–ï¸ Abogados</option>
                <option value="Contables">ğŸ“‹ Contables</option>
                <option value="Salones de Eventos">ğŸ‰ Salones de Eventos</option>
                <option value="Mudanzas y Transporte">ğŸšš Mudanzas y Transporte</option>
                <option value="PlomerÃ­a y Electricidad">âš¡ PlomerÃ­a y Electricidad</option>
                <option value="JardinerÃ­a">ğŸŒ± JardinerÃ­a</option>
                <option value="Mascotas y Suministros">ğŸ• Mascotas y Suministros</option>
                <option value="Servicios">ğŸ§° Servicios</option>
              </optgroup>
              
              <optgroup label="ğŸª Otros">
                <option value="Comercio">ğŸª Comercios</option>
                <option value="Otros">âœ¨ Otros</option>
              </optgroup>

            </select>
          </div>

          <div class="col-md-7">
            <label class="form-label fw-bold required">UbicaciÃ³n (texto)</label>
            <input type="text" name="ubicacion" class="form-control form-control-lg" required
                   placeholder="Ej: 200m norte de la iglesia, San Juan de PoÃ¡s">
            <div class="hint mt-1">Esto es lo que verÃ¡ la gente, aunque el pin sea exacto.</div>
          </div>

          <div class="col-md-5">
            <label class="form-label fw-bold">Link de Google Maps (opcional)</label>
            <input type="url" name="maps_url" class="form-control form-control-lg" placeholder="https://maps.app.goo.gl/...">
          </div>

          <div class="col-md-4">
            <label class="form-label fw-bold">TelÃ©fono (opcional)</label>
            <input type="text" name="telefono" class="form-control form-control-lg" placeholder="Ej: 2448-5858">
          </div>

          <div class="col-md-4">
            <label class="form-label fw-bold">WhatsApp (opcional)</label>
            <input type="text" name="whatsapp" class="form-control form-control-lg" placeholder="Ej: +506 8888-8888">
          </div>

          <div class="col-md-4">
            <label class="form-label fw-bold">Horario (opcional)</label>
            <input type="text" id="horario" name="horario" class="form-control form-control-lg"
                   placeholder="Ej: Lun-Vie 8:00-18:00, SÃ¡b 9:00-14:00">
            <div class="hint mt-1">Si marcÃ¡s 24 horas, el horario se ignora.</div>
          </div>

          <div class="col-md-4 d-flex align-items-end">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="abierto_24h" name="abierto_24h" value="1">
              <label class="form-check-label fw-bold" for="abierto_24h">Abierto 24 horas</label>
            </div>
          </div>

          <div class="col-md-4">
            <label class="form-label fw-bold">Foto / Logo (opcional)</label>
            <input type="file" name="foto" class="form-control form-control-lg">
            <div class="hint mt-1">Si no subÃ­s foto, se usa el logo por defecto.</div>
          </div>

          <div class="col-12">
            <label class="form-label fw-bold required">DescripciÃ³n</label>
            <textarea name="descripcion" rows="4" class="form-control form-control-lg" required
                      placeholder="Describe lo que ofrece, horarios, servicios, etc."></textarea>
          </div>

        </div>

        <hr class="my-4">

        <!-- MAPA -->
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div class="fw-bold">
            <i class="fa-solid fa-map-pin me-2"></i> MarcÃ¡ la ubicaciÃ³n exacta
          </div>
          <div class="hint">TocÃ¡ el mapa para colocar el pin âœ…</div>
        </div>

        <div id="map"></div>

        <!-- hidden lat/long (se llenan con el pin) -->
        <input type="hidden" id="latitud" name="latitud" value="">
        <input type="hidden" id="longitud" name="longitud" value="">

        <div class="hint mt-2">
          Si no marcÃ¡s el pin, se puede publicar igual, pero es mejor marcarlo para salir bien en el mapa.
        </div>

        <div class="d-flex gap-2 mt-4">
          <button type="submit" class="btn btn-success btn-lg px-4">
            <i class="fa-solid fa-paper-plane me-2"></i> Publicar
          </button>
          <a href="/" class="btn btn-outline-secondary btn-lg px-4">
            Cancelar
          </a>
        </div>

      </form>
    </div>
  </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // Centro por defecto (Costa Rica)
  const defaultLat = 9.9281;
  const defaultLng = -84.0907;

  const latInput = document.getElementById("latitud");
  const lngInput = document.getElementById("longitud");

  const map = L.map('map').setView([defaultLat, defaultLng], 12);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  let marker = null;

  function setMarker(lat, lng){
    if(marker) map.removeLayer(marker);
    marker = L.marker([lat, lng]).addTo(map);
    latInput.value = lat.toFixed(6);
    lngInput.value = lng.toFixed(6);
  }

  // Click para poner pin
  map.on('click', function(e){
    setMarker(e.latlng.lat, e.latlng.lng);
  });

  // Horario vs 24h
  const chk24 = document.getElementById("abierto_24h");
  const horarioInput = document.getElementById("horario");
  if (chk24 && horarioInput) {
    function syncHorario() {
      const is24 = chk24.checked;
      horarioInput.disabled = is24;
      if (is24) horarioInput.value = "";
    }
    chk24.addEventListener("change", syncHorario);
    syncHorario();
  }
</script>

</body>
</html>

